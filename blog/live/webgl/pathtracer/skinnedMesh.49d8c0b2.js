let e,t,s,r,i,o,a,n,l,u,d,h;function c(e,t,s,r){Object.defineProperty(e,t,{get:s,set:r,enumerable:!0,configurable:!0})}var p=globalThis,m={},g={},f=p.parcelRequire5b70;null==f&&((f=function(e){if(e in m)return m[e].exports;if(e in g){var t=g[e];delete g[e];var s={id:e,exports:{}};return m[e]=s,t.call(s.exports,s,s.exports),s.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){g[e]=t},p.parcelRequire5b70=f);var N=f.register;N("eLX8K",function(e,t){c(e.exports,"BlurredEnvMapGenerator",()=>n);var s=f("ilwiq"),r=f("RPVlj"),i=f("9fZ6X"),o=f("dUUQZ");class a extends i.MaterialBase{constructor(){super({uniforms:{envMap:{value:null},blur:{value:0}},vertexShader:`

				varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}

			`,fragmentShader:`

				#include <common>
				#include <cube_uv_reflection_fragment>

				${o.util_functions}

				uniform sampler2D envMap;
				uniform float blur;
				varying vec2 vUv;
				void main() {

					vec3 rayDirection = equirectUvToDirection( vUv );
					gl_FragColor = textureCubeUV( envMap, rayDirection, blur );

				}

			`})}}class n{constructor(e){this.renderer=e,this.pmremGenerator=new s.PMREMGenerator(e),this.copyQuad=new r.FullScreenQuad(new a),this.renderTarget=new s.WebGLRenderTarget(1,1,{type:s.FloatType,format:s.RGBAFormat})}dispose(){this.pmremGenerator.dispose(),this.copyQuad.dispose(),this.renderTarget.dispose()}generate(e,t){let{pmremGenerator:r,renderTarget:i,copyQuad:o,renderer:a}=this,n=r.fromEquirectangular(e),{width:l,height:u}=e.image;i.setSize(l,u),o.material.envMap=n.texture,o.material.blur=t;let d=a.getRenderTarget(),h=a.autoClear;a.setRenderTarget(i),a.autoClear=!0,o.render(a),a.setRenderTarget(d),a.autoClear=h;let c=new Uint16Array(l*u*4),p=new Float32Array(l*u*4);a.readRenderTargetPixels(i,0,0,l,u,p);for(let e=0,t=p.length;e<t;e++)c[e]=(0,s.DataUtils).toHalfFloat(p[e]);let m=new s.DataTexture(c,l,u,s.RGBAFormat,s.HalfFloatType);return m.minFilter=e.minFilter,m.magFilter=e.magFilter,m.wrapS=e.wrapS,m.wrapT=e.wrapT,m.mapping=s.EquirectangularReflectionMapping,m.needsUpdate=!0,n.dispose(),m}}}),N("9fZ6X",function(e,t){c(e.exports,"MaterialBase",()=>r);var s=f("ilwiq");class r extends s.ShaderMaterial{set needsUpdate(e){super.needsUpdate=!0,this.dispatchEvent({type:"recompilation"})}constructor(e){for(let t in super(e),this.uniforms)Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}})}setDefine(e,t){if(null==t){if(e in this.defines)return delete this.defines[e],this.needsUpdate=!0,!0}else if(this.defines[e]!==t)return this.defines[e]=t,this.needsUpdate=!0,!0;return!1}}}),N("dUUQZ",function(e,t){c(e.exports,"util_functions",()=>s);let s=`

	// TODO: possibly this should be renamed something related to material or path tracing logic

	#ifndef RAY_OFFSET
	#define RAY_OFFSET 1e-4
	#endif

	// adjust the hit point by the surface normal by a factor of some offset and the
	// maximum component-wise value of the current point to accommodate floating point
	// error as values increase.
	vec3 stepRayOrigin( vec3 rayOrigin, vec3 rayDirection, vec3 offset, float dist ) {

		vec3 point = rayOrigin + rayDirection * dist;
		vec3 absPoint = abs( point );
		float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
		return point + offset * ( maxPoint + 1.0 ) * RAY_OFFSET;

	}

	// https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_materials_volume/README.md#attenuation
	vec3 transmissionAttenuation( float dist, vec3 attColor, float attDist ) {

		vec3 ot = - log( attColor ) / attDist;
		return exp( - ot * dist );

	}

	vec3 getHalfVector( vec3 wi, vec3 wo, float eta ) {

		// get the half vector - assuming if the light incident vector is on the other side
		// of the that it's transmissive.
		vec3 h;
		if ( wi.z > 0.0 ) {

			h = normalize( wi + wo );

		} else {

			// Scale by the ior ratio to retrieve the appropriate half vector
			// From Section 2.2 on computing the transmission half vector:
			// https://blog.selfshadow.com/publications/s2015-shading-course/burley/s2015_pbs_disney_bsdf_notes.pdf
			h = normalize( wi + wo * eta );

		}

		h *= sign( h.z );
		return h;

	}

	vec3 getHalfVector( vec3 a, vec3 b ) {

		return normalize( a + b );

	}

	// The discrepancy between interpolated surface normal and geometry normal can cause issues when a ray
	// is cast that is on the top side of the geometry normal plane but below the surface normal plane. If
	// we find a ray like that we ignore it to avoid artifacts.
	// This function returns if the direction is on the same side of both planes.
	bool isDirectionValid( vec3 direction, vec3 surfaceNormal, vec3 geometryNormal ) {

		bool aboveSurfaceNormal = dot( direction, surfaceNormal ) > 0.0;
		bool aboveGeometryNormal = dot( direction, geometryNormal ) > 0.0;
		return aboveSurfaceNormal == aboveGeometryNormal;

	}

	// ray sampling x and z are swapped to align with expected background view
	vec2 equirectDirectionToUv( vec3 direction ) {

		// from Spherical.setFromCartesianCoords
		vec2 uv = vec2( atan( direction.z, direction.x ), acos( direction.y ) );
		uv /= vec2( 2.0 * PI, PI );

		// apply adjustments to get values in range [0, 1] and y right side up
		uv.x += 0.5;
		uv.y = 1.0 - uv.y;
		return uv;

	}

	vec3 equirectUvToDirection( vec2 uv ) {

		// undo above adjustments
		uv.x -= 0.5;
		uv.y = 1.0 - uv.y;

		// from Vector3.setFromSphericalCoords
		float theta = uv.x * 2.0 * PI;
		float phi = uv.y * PI;

		float sinPhi = sin( phi );

		return vec3( sinPhi * cos( theta ), cos( phi ), sinPhi * sin( theta ) );

	}

	// power heuristic for multiple importance sampling
	float misHeuristic( float a, float b ) {

		float aa = a * a;
		float bb = b * b;
		return aa / ( aa + bb );

	}

	// tentFilter from Peter Shirley's 'Realistic Ray Tracing (2nd Edition)' book, pg. 60
	// erichlof/THREE.js-PathTracing-Renderer/
	float tentFilter( float x ) {

		return x < 0.5 ? sqrt( 2.0 * x ) - 1.0 : 1.0 - sqrt( 2.0 - ( 2.0 * x ) );

	}
`}),N("891vQ",function(e,t){c(e.exports,"RGBELoader",()=>r);var s=f("ilwiq");class r extends s.DataTextureLoader{constructor(e){super(e),this.type=s.HalfFloatType}parse(e){let t,r,i;let o=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,s){t=t||1024;let r=e.pos,i=-1,o=0,a="",n=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=n.indexOf("\n"))&&o<t&&r<e.byteLength;)a+=n,o+=n.length,r+=128,n+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return -1<i&&(!1!==s&&(e.pos+=o+i+1),a+n.slice(0,i))},n=new Uint8Array(e);n.pos=0;let l=function(e){let t,s;let r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=a(e))||o(1,"no header found"),(s=t.match(/^#\?(\S+)/))||o(3,"bad initial token"),u.valid|=1,u.programtype=s[1],u.string+=t+"\n";!1!==(t=a(e));){if(u.string+=t+"\n","#"===t.charAt(0)){u.comments+=t+"\n";continue}if((s=t.match(r))&&(u.gamma=parseFloat(s[1])),(s=t.match(i))&&(u.exposure=parseFloat(s[1])),(s=t.match(n))&&(u.valid|=2,u.format=s[1]),(s=t.match(l))&&(u.valid|=4,u.height=parseInt(s[1],10),u.width=parseInt(s[2],10)),2&u.valid&&4&u.valid)break}return 2&u.valid||o(3,"missing format specifier"),4&u.valid||o(3,"missing image size specifier"),u}(n),u=l.width,d=l.height,h=function(e,t,s){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&o(3,"wrong scanline width");let r=new Uint8Array(4*t*s);r.length||o(4,"unable to allocate buffer space");let i=0,a=0,n=4*t,l=new Uint8Array(4),u=new Uint8Array(n),d=s;for(;d>0&&a<e.byteLength;){a+4>e.byteLength&&o(1),l[0]=e[a++],l[1]=e[a++],l[2]=e[a++],l[3]=e[a++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&o(3,"bad rgbe scanline format");let s=0,h;for(;s<n&&a<e.byteLength;){let t=(h=e[a++])>128;if(t&&(h-=128),(0===h||s+h>n)&&o(3,"bad scanline data"),t){let t=e[a++];for(let e=0;e<h;e++)u[s++]=t}else u.set(e.subarray(a,a+h),s),s+=h,a+=h}for(let e=0;e<t;e++){let s=0;r[i]=u[e+s],s+=t,r[i+1]=u[e+s],s+=t,r[i+2]=u[e+s],s+=t,r[i+3]=u[e+s],i+=4}d--}return r}(n.subarray(n.pos),u,d);switch(this.type){case s.FloatType:let c=new Float32Array(4*(i=h.length/4));for(let e=0;e<i;e++)!function(e,t,s,r){let i=Math.pow(2,e[t+3]-128)/255;s[r+0]=e[t+0]*i,s[r+1]=e[t+1]*i,s[r+2]=e[t+2]*i,s[r+3]=1}(h,4*e,c,4*e);t=c,r=s.FloatType;break;case s.HalfFloatType:let p=new Uint16Array(4*(i=h.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let o=Math.pow(2,e[t+3]-128)/255;r[i+0]=(0,s.DataUtils).toHalfFloat(Math.min(e[t+0]*o,65504)),r[i+1]=(0,s.DataUtils).toHalfFloat(Math.min(e[t+1]*o,65504)),r[i+2]=(0,s.DataUtils).toHalfFloat(Math.min(e[t+2]*o,65504)),r[i+3]=(0,s.DataUtils).toHalfFloat(1)}(h,4*e,p,4*e);t=p,r=s.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:u,height:d,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){switch(e.type){case s.FloatType:case s.HalfFloatType:e.colorSpace=s.LinearSRGBColorSpace,e.minFilter=s.LinearFilter,e.magFilter=s.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,i)}}}),N("1EdOY",function(e,t){c(e.exports,"generateRadialFloorTexture",()=>r);var s=f("ilwiq");function r(e){let t=new Uint8Array(e*e*4);for(let s=0;s<e;s++)for(let r=0;r<e;r++){let i=Math.max(Math.min(1-Math.sqrt((2*(s/(e-1)-.5))**2+(2*(r/(e-1)-.5))**2),1),0);i=Math.min(i=i**2*1.5,1);let o=r*e+s;t[4*o+0]=255,t[4*o+1]=255,t[4*o+2]=255,t[4*o+3]=255*i}let r=new s.DataTexture(t,e,e);return r.format=s.RGBAFormat,r.type=s.UnsignedByteType,r.minFilter=s.LinearFilter,r.magFilter=s.LinearFilter,r.wrapS=s.RepeatWrapping,r.wrapT=s.RepeatWrapping,r.needsUpdate=!0,r}}),N("cE5k3",function(e,t){c(e.exports,"getScaledSettings",()=>s);function s(){let e=3,t=Math.max(1/window.devicePixelRatio,.5);return window.innerWidth/window.innerHeight<.65&&(e=4,t=.5/window.devicePixelRatio),{tiles:e,renderScale:t}}}),N("e2Pv4",function(e,t){let s;c(e.exports,"LoaderElement",()=>r);class r{constructor(){s||((s=document.createElement("style")).textContent=`

		.loader-container, .description {
			position: absolute;
			width: 100%;
			font-family: 'Courier New', Courier, monospace;
			color: white;
			font-weight: light;
			align-items: flex-start;
			font-size: 14px;
			pointer-events: none;
			user-select: none;
		}

		.loader-container {
			display: flex;
			flex-direction: column;
			bottom: 0;
		}

		.description {
			top: 0;
			width: 100%;
			text-align: center;
			padding: 5px 0;
		}

		.loader-container .bar {
			height: 2px;
			background: white;
			width: 100%;
		}

		.loader-container .credits,
		.loader-container .samples,
		.loader-container .percentage {
			padding: 5px;
			margin: 0 0 1px 1px;
			background: rgba( 0, 0, 0, 0.2 );
			border-radius: 2px;
			display: inline-block;
		}

		.loader-container:not(.loading) .bar,
		.loader-container:not(.loading) .percentage,
		.loader-container.loading .credits,
		.loader-container.loading .samples,
		.loader-container .credits:empty {
			display: none;
		}

		.loader-container .credits a,
		.loader-container .credits,
		.loader-container .samples {
			color: rgba( 255, 255, 255, 0.75 );
		}
	`,document.head.appendChild(s));let e=document.createElement("div");e.classList.add("loader-container");let t=document.createElement("div");t.classList.add("percentage"),e.appendChild(t);let r=document.createElement("div");r.classList.add("samples"),e.appendChild(r);let i=document.createElement("div");i.classList.add("credits"),e.appendChild(i);let o=document.createElement("div");o.classList.add("bar"),e.appendChild(o);let a=document.createElement("div");a.classList.add("description"),e.appendChild(a),this._description=a,this._loaderBar=o,this._percentage=t,this._credits=i,this._samples=r,this._container=e,this.setPercentage(0)}attach(e){e.appendChild(this._container),e.appendChild(this._description)}setPercentage(e){this._loaderBar.style.width=`${100*e}%`,0===e?this._percentage.innerText="Loading...":this._percentage.innerText=`${(100*e).toFixed(0)}%`,e>=1?this._container.classList.remove("loading"):this._container.classList.add("loading")}setSamples(e,t=!1){t?this._samples.innerText="compiling shader...":this._samples.innerText=`${Math.floor(e)} samples`}setCredits(e){this._credits.innerHTML=e}setDescription(e){this._description.innerHTML=e}}}),N("fYvb1",function(e,t){c(e.exports,"math_functions",()=>s);let s=`

	// Fast arccos approximation used to remove banding artifacts caused by numerical errors in acos.
	// This is a cubic Lagrange interpolating polynomial for x = [-1, -1/2, 0, 1/2, 1].
	// For more information see: https://github.com/disini/three-gpu-pathtracer/pull/171#issuecomment-1152275248
	float acosApprox( float x ) {

		x = clamp( x, -1.0, 1.0 );
		return ( - 0.69813170079773212 * x * x - 0.87266462599716477 ) * x + 1.5707963267948966;

	}

	// An acos with input values bound to the range [-1, 1].
	float acosSafe( float x ) {

		return acos( clamp( x, -1.0, 1.0 ) );

	}

	float saturateCos( float val ) {

		return clamp( val, 0.001, 1.0 );

	}

	float square( float t ) {

		return t * t;

	}

	vec2 square( vec2 t ) {

		return t * t;

	}

	vec3 square( vec3 t ) {

		return t * t;

	}

	vec4 square( vec4 t ) {

		return t * t;

	}

	vec2 rotateVector( vec2 v, float t ) {

		float ac = cos( t );
		float as = sin( t );
		return vec2(
			v.x * ac - v.y * as,
			v.x * as + v.y * ac
		);

	}

	// forms a basis with the normal vector as Z
	mat3 getBasisFromNormal( vec3 normal ) {

		vec3 other;
		if ( abs( normal.x ) > 0.5 ) {

			other = vec3( 0.0, 1.0, 0.0 );

		} else {

			other = vec3( 1.0, 0.0, 0.0 );

		}

		vec3 ortho = normalize( cross( normal, other ) );
		vec3 ortho2 = normalize( cross( normal, ortho ) );
		return mat3( ortho2, ortho, normal );

	}

`}),N("8keuf",function(e,t){c(e.exports,"ggx_functions",()=>s);let s=`

	// The GGX functions provide sampling and distribution information for normals as output so
	// in order to get probability of scatter direction the half vector must be computed and provided.
	// [0] https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf
	// [1] https://hal.archives-ouvertes.fr/hal-01509746/document
	// [2] http://jcgt.org/published/0007/04/01/
	// [4] http://jcgt.org/published/0003/02/03/

	// trowbridge-reitz === GGX === GTR

	vec3 ggxDirection( vec3 incidentDir, vec2 roughness, vec2 uv ) {

		// TODO: try GGXVNDF implementation from reference [2], here. Needs to update ggxDistribution
		// function below, as well

		// Implementation from reference [1]
		// stretch view
		vec3 V = normalize( vec3( roughness * incidentDir.xy, incidentDir.z ) );

		// orthonormal basis
		vec3 T1 = ( V.z < 0.9999 ) ? normalize( cross( V, vec3( 0.0, 0.0, 1.0 ) ) ) : vec3( 1.0, 0.0, 0.0 );
		vec3 T2 = cross( T1, V );

		// sample point with polar coordinates (r, phi)
		float a = 1.0 / ( 1.0 + V.z );
		float r = sqrt( uv.x );
		float phi = ( uv.y < a ) ? uv.y / a * PI : PI + ( uv.y - a ) / ( 1.0 - a ) * PI;
		float P1 = r * cos( phi );
		float P2 = r * sin( phi ) * ( ( uv.y < a ) ? 1.0 : V.z );

		// compute normal
		vec3 N = P1 * T1 + P2 * T2 + V * sqrt( max( 0.0, 1.0 - P1 * P1 - P2 * P2 ) );

		// unstretch
		N = normalize( vec3( roughness * N.xy, max( 0.0, N.z ) ) );

		return N;

	}

	// Below are PDF and related functions for use in a Monte Carlo path tracer
	// as specified in Appendix B of the following paper
	// See equation (34) from reference [0]
	float ggxLamda( float theta, float roughness ) {

		float tanTheta = tan( theta );
		float tanTheta2 = tanTheta * tanTheta;
		float alpha2 = roughness * roughness;

		float numerator = - 1.0 + sqrt( 1.0 + alpha2 * tanTheta2 );
		return numerator / 2.0;

	}

	// See equation (34) from reference [0]
	float ggxShadowMaskG1( float theta, float roughness ) {

		return 1.0 / ( 1.0 + ggxLamda( theta, roughness ) );

	}

	// See equation (125) from reference [4]
	float ggxShadowMaskG2( vec3 wi, vec3 wo, float roughness ) {

		float incidentTheta = acos( wi.z );
		float scatterTheta = acos( wo.z );
		return 1.0 / ( 1.0 + ggxLamda( incidentTheta, roughness ) + ggxLamda( scatterTheta, roughness ) );

	}

	// See equation (33) from reference [0]
	float ggxDistribution( vec3 halfVector, float roughness ) {

		float a2 = roughness * roughness;
		a2 = max( EPSILON, a2 );
		float cosTheta = halfVector.z;
		float cosTheta4 = pow( cosTheta, 4.0 );

		if ( cosTheta == 0.0 ) return 0.0;

		float theta = acosSafe( halfVector.z );
		float tanTheta = tan( theta );
		float tanTheta2 = pow( tanTheta, 2.0 );

		float denom = PI * cosTheta4 * pow( a2 + tanTheta2, 2.0 );
		return ( a2 / denom );

	}

	// See equation (3) from reference [2]
	float ggxPDF( vec3 wi, vec3 halfVector, float roughness ) {

		float incidentTheta = acos( wi.z );
		float D = ggxDistribution( halfVector, roughness );
		float G1 = ggxShadowMaskG1( incidentTheta, roughness );

		return D * G1 * max( 0.0, dot( wi, halfVector ) ) / wi.z;

	}

`});var y=f("ilwiq"),v=f("7lx9d"),T=f("5Rd1x"),x=f("eLX8K"),b=f("8mHfG"),w=f("891vQ"),V=f("kp7Te"),_=f("jiuw3"),E=f("1EdOY"),A=f("cE5k3"),M=f("e2Pv4");const R="vertex",S={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},C=["x","y","z","w"];var y=(f("ilwiq"),f("ilwiq"));function L(e,t=!1){let s="{";for(let{property:r,childNode:i}of(!0===e.isNode&&(s+=e.id),I(e)))s+=","+r.slice(0,-4)+":"+i.getCacheKey(t);return s+"}"}function*I(e,t=!1){for(let s in e){if(!0===s.startsWith("_"))continue;let r=e[s];if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){let i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:s,index:e,childNode:i})}else if(r&&!0===r.isNode)yield{property:s,childNode:r};else if("object"==typeof r)for(let e in r){let i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:s,index:e,childNode:i})}}}function O(e){if(null==e)return null;let t=typeof e;if(!0===e.isNode)return"node";if("number"===t)return"float";if("boolean"===t)return"bool";if("string"===t)return"string";if("function"===t)return"shader";if(!0===e.isVector2)return"vec2";if(!0===e.isVector3)return"vec3";else if(!0===e.isVector4)return"vec4";else if(!0===e.isMatrix3)return"mat3";else if(!0===e.isMatrix4)return"mat4";else if(!0===e.isColor)return"color";else if(e instanceof ArrayBuffer)return"ArrayBuffer";return null}function D(e,...t){let s=e?e.slice(-4):void 0;if(1===t.length&&("vec2"===s?t=[t[0],t[0]]:"vec3"===s?t=[t[0],t[0],t[0]]:"vec4"===s&&(t=[t[0],t[0],t[0],t[0]])),"color"===e)return new y.Color(...t);if("vec2"===s)return new y.Vector2(...t);if("vec3"===s)return new y.Vector3(...t);if("vec4"===s)return new y.Vector4(...t);if("mat3"===s)return new y.Matrix3(...t);if("mat4"===s)return new y.Matrix4(...t);if("bool"===e)return t[0]||!1;else if("float"===e||"int"===e||"uint"===e)return t[0]||0;else if("string"===e)return t[0]||"";else if("ArrayBuffer"===e)return F(t[0]);return null}function z(e){let t="",s=new Uint8Array(e);for(let e=0;e<s.length;e++)t+=String.fromCharCode(s[e]);return btoa(t)}function F(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}const P=new Map;let U=0;class B extends y.EventDispatcher{constructor(e=null){super(),this.nodeType=e,this.updateType=S.NONE,this.updateBeforeType=S.NONE,this.uuid=(0,y.MathUtils).generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.isNode=!0,Object.defineProperty(this,"id",{value:U++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,S.FRAME)}onRenderUpdate(e){return this.onUpdate(e,S.RENDER)}onObjectUpdate(e){return this.onUpdate(e,S.OBJECT)}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(let{childNode:e}of I(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){for(let t of(e(this),this.getChildren()))t.traverse(e)}getCacheKey(e=!1){return(!0===(e=e||this.version!==this._cacheKeyVersion)||null===this._cacheKey)&&(this._cacheKey=L(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){let t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){let t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){let t=e.getNodeProperties(this);for(let e of this.getChildren())t["_node"+e.id]=e;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}increaseUsage(e){let t=e.getDataFromNode(this);return t.usageCount=void 0===t.usageCount?1:t.usageCount+1,t.usageCount}analyze(e){if(1===this.increaseUsage(e))for(let t of Object.values(e.getNodeProperties(this)))t&&!0===t.isNode&&t.build(e)}generate(e,t){let{outputNode:s}=e.getNodeProperties(this);if(s&&!0===s.isNode)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){let s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let r=null,i=e.getBuildStage();if("setup"===i){this.updateReference(e);let t=e.getNodeProperties(this);if(!0!==t.initialized||!1===e.context.tempRead){let s=e.stack.nodes.length;for(let r of(t.initialized=!0,t.outputNode=this.setup(e),null!==t.outputNode&&e.stack.nodes.length!==s&&(t.outputNode=e.stack),Object.values(t)))r&&!0===r.isNode&&r.build(e)}}else if("analyze"===i)this.analyze(e);else if("generate"===i){if(1===this.generate.length){let s=this.getNodeType(e),i=e.getDataFromNode(this);void 0===(r=i.snippet)&&(r=this.generate(e)||"",i.snippet=r),r=e.format(r,s,t)}else r=this.generate(e,t)||""}return e.removeChain(this),r}getSerializeChildren(){return I(this)}serialize(e){let t=this.getSerializeChildren(),s={};for(let{property:r,index:i,childNode:o}of t)void 0!==i?(void 0===s[r]&&(s[r]=Number.isInteger(i)?[]:{}),s[r][i]=o.toJSON(e.meta).uuid):s[r]=o.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(void 0!==e.inputNodes){let t=e.meta.nodes;for(let s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){let r=[];for(let i of e.inputNodes[s])r.push(t[i]);this[s]=r}else if("object"==typeof e.inputNodes[s]){let r={};for(let i in e.inputNodes[s]){let o=e.inputNodes[s][i];r[i]=t[o]}this[s]=r}else{let r=e.inputNodes[s];this[s]=t[r]}}}toJSON(e){let{uuid:t,type:s}=this,r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];function o(e){let t=[];for(let s in e){let r=e[s];delete r.metadata,t.push(r)}return t}if(void 0===i&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){let t=o(e.textures),s=o(e.images),r=o(e.nodes);t.length>0&&(i.textures=t),s.length>0&&(i.images=s),r.length>0&&(i.nodes=r)}return i}}var G=B;function H(e,t){if("function"!=typeof t||!e)throw Error(`Node class ${e} is not a class`);if(P.has(e)){console.warn(`Redefinition of node class ${e}`);return}P.set(e,t),t.type=e}class k extends G{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){let s=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(!1!==e.context.tempRead&&void 0!==r.propertyName)return e.format(r.propertyName,s,t);if(!1!==e.context.tempWrite&&"void"!==s&&"void"!==t&&this.hasDependencies(e)){let i=super.build(e,s),o=e.getVarFromNode(this,null,s),a=e.getPropertyName(o);return e.addLineFlowCode(`${a} = ${i}`),r.snippet=i,r.propertyName=a,e.format(r.propertyName,s,t)}}return super.build(e,t)}}var q=k;H("TempNode",k);class W extends G{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){let t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}var j=W;H("ArrayElementNode",W);class X extends G{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){let t=this.node.getNodeType(e),s=null;for(let r of this.convertTo.split("|"))(null===s||e.getTypeLength(t)===e.getTypeLength(r))&&(s=r);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){let s=this.node,r=this.getNodeType(e),i=s.build(e,r);return e.format(i,r,t)}}H("ConvertNode",X);class $ extends q{constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){let s=this.getNodeType(e),r=this.nodes,i=e.getComponentType(s),o=[];for(let t of r){let s=t.build(e),r=e.getComponentType(t.getNodeType(e));r!==i&&(s=e.format(s,r,i)),o.push(s)}let a=`${e.getType(s)}( ${o.join(", ")} )`;return e.format(a,s,t)}}H("JoinNode",$);const Y=C.join("");class J extends G{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(let t of this.components)e=Math.max(C.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){let s=this.node,r=e.getTypeLength(s.getNodeType(e)),i=null;if(r>1){let o=null;this.getVectorLength()>=r&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));let a=s.build(e,o);i=this.components.length===r&&this.components===Y.slice(0,this.components.length)?e.format(a,o,t):e.format(`${a}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}H("SplitNode",J);class K extends q{constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{sourceNode:t,components:s,targetNode:r}=this,i=this.getNodeType(e),o=e.getTypeFromLength(s.length),a=r.build(e,o),n=t.build(e,i),l=e.getTypeLength(i),u=[];for(let e=0;e<l;e++){let t=C[e];t===s[0]?(u.push(a),e+=s.length-1):u.push(n+"."+t)}return`${e.getType(i)}( ${u.join(", ")} )`}}H("SetNode",K);class Z extends G{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?O(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=O(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=z(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?D(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}var Q=Z;H("InputNode",Z);class ee extends Q{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){let s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}H("ConstNode",ee);let et=null;const es=new Map;function er(e,t){if(es.has(e)){console.warn(`Redefinition of node element ${e}`);return}if("function"!=typeof t)throw Error(`Node element ${e} is not a function`);es.set(e,t)}const ei=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),eo={setup:(e,t)=>e(eA(t.shift()),...t),get(e,t,s){if("string"==typeof t&&void 0===e[t]){if(!0!==e.isStackNode&&"assign"===t)return(...e)=>(et.assign(s,...e),s);if(es.has(t)){let r=es.get(t);return e.isStackNode?(...e)=>s.add(r(...e)):(...e)=>r(s,...e)}if("self"===t)return e;if(t.endsWith("Assign")&&es.has(t.slice(0,t.length-6))){let r=es.get(t.slice(0,t.length-6));return e.isStackNode?(...e)=>s.assign(e[0],r(...e)):(...e)=>s.assign(r(s,...e))}else if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return eE(new J(s,t=ei(t)));else if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(t))return t=(t=ei(t.slice(3).toLowerCase())).split("").sort().join(""),s=>eE(new K(e,t,s));else if("width"===t||"height"===t||"depth"===t)return"width"===t?t="x":"height"===t?t="y":"depth"===t&&(t="z"),eE(new J(e,t));else if(!0===/^\d+$/.test(t))return eE(new j(s,new ee(Number(t),"uint")))}return Reflect.get(e,t,s)},set:(e,t,s,r)=>"string"==typeof t&&void 0===e[t]&&(!0===/^[xyzwrgbastpq]{1,4}$/.test(t)||"width"===t||"height"===t||"depth"===t||!0===/^\d+$/.test(t))?(r[t].assign(s),!0):Reflect.set(e,t,s,r)},ea=new WeakMap,en=new WeakMap,el=function(e,t=null){let s=O(e);if("node"===s){let t=ea.get(e);return void 0===t&&(t=new Proxy(e,eo),ea.set(e,t),ea.set(t,t)),t}return null===t&&("float"===s||"boolean"===s)||s&&"shader"!==s&&"string"!==s?eE(ex(e,t)):"shader"===s?eC(e):e},eu=function(e,t=null){for(let s in e)e[s]=eE(e[s],t);return e},ed=function(e,t=null){let s=e.length;for(let r=0;r<s;r++)e[r]=eE(e[r],t);return e},eh=function(e,t=null,s=null,r=null){let i=e=>eE(null!==r?Object.assign(e,r):e);return null===t?(...t)=>i(new e(...eM(t))):null!==s?(s=eE(s),(...r)=>i(new e(t,...eM(r),s))):(...s)=>i(new e(t,...eM(s)))},ec=function(e,...t){return eE(new e(...eM(t)))};class ep extends G{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){let{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){let{shaderNode:t,inputNodes:s}=this;if(t.layout){let r=en.get(e.constructor);void 0===r&&(r=new WeakMap,en.set(e.constructor,r));let i=r.get(t);return void 0===i&&(i=eE(e.buildFunctionNode(t)),r.set(t,i)),null!==e.currentFunctionNode&&e.currentFunctionNode.includes.push(i),eE(i.call(s))}let r=t.jsFunc;return eE(null!==s?r(s,e.stack,e):r(e.stack,e))}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){let{outputNode:s}=e.getNodeProperties(this);return null===s?this.call(e).build(e,t):super.generate(e,t)}}class em extends G{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return eA(e),eE(new ep(this,e))}setup(){return this.call()}}const eg=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],ef=new Map;for(const e of[!1,!0])ef.set(e,new ee(e));const eN=new Map;for(const e of[0,1,2,3])eN.set(e,new ee(e,"uint"));const ey=new Map([...eN].map(e=>new ee(e.value,"int")));for(const e of[-1,-2])ey.set(e,new ee(e,"int"));const ev=new Map([...ey].map(e=>new ee(e.value)));for(const e of eg)ev.set(e,new ee(e));for(const e of eg)ev.set(-e,new ee(-e));const eT=new Map([...ef,...ev]),ex=(e,t)=>eT.has(e)?eT.get(e):!0===e.isNode?e:new ee(e,t),eb=e=>{try{return e.getNodeType()}catch(e){return}},ew=function(e,t=null){return(...s)=>{if((0===s.length||!["bool","float","int","uint"].includes(e)&&s.every(e=>"object"!=typeof e))&&(s=[D(e,...s)]),1===s.length&&null!==t&&t.has(s[0]))return eE(t.get(s[0]));if(1===s.length){let t=ex(s[0],e);return eb(t)===e?eE(t):eE(new X(t,e))}return eE(new $(s.map(e=>ex(e)),e))}},eV=e=>null!=e?e.nodeType||e.convertTo||("string"==typeof e?e:null):null;function e_(e){return new Proxy(new em(e),eo)}const eE=(e,t=null)=>el(e,t),eA=(e,t=null)=>new eu(e,t),eM=(e,t=null)=>new ed(e,t),eR=(...e)=>new eh(...e),eS=(...e)=>new ec(...e),eC=e=>{let t=new e_(e),s=(...e)=>{let s;return eA(e),s=e[0]&&e[0].isNode?[...e]:e[0],t.call(s)};return s.shaderNode=t,s.setLayout=e=>(t.setLayout(e),s),s};H("ShaderNode",e_);const eL=e=>{et=e},eI=()=>et,eO=(...e)=>et.if(...e);er("append",function(e){return et&&et.add(e),e});const eD=new ew("color"),ez=new ew("float",ev),eF=new ew("int",ey),eP=new ew("uint",eN),eU=new ew("bool",ef),eB=new ew("vec2"),eG=new ew("ivec2"),eH=new ew("uvec2"),ek=new ew("bvec2"),eq=new ew("vec3"),eW=new ew("ivec3"),ej=new ew("uvec3"),eX=new ew("bvec3"),e$=new ew("vec4"),eY=new ew("ivec4"),eJ=new ew("uvec4"),eK=new ew("bvec4"),eZ=new ew("mat2"),eQ=new ew("imat2"),e0=new ew("umat2"),e1=new ew("bmat2"),e2=new ew("mat3"),e3=new ew("imat3"),e4=new ew("umat3"),e5=new ew("bmat3"),e6=new ew("mat4"),e9=new ew("imat4"),e8=new ew("umat4"),e7=new ew("bmat4");er("color",eD),er("float",ez),er("int",eF),er("uint",eP),er("bool",eU),er("vec2",eB),er("ivec2",eG),er("uvec2",eH),er("bvec2",ek),er("vec3",eq),er("ivec3",eW),er("uvec3",ej),er("bvec3",eX),er("vec4",e$),er("ivec4",eY),er("uvec4",eJ),er("bvec4",eK),er("mat2",eZ),er("imat2",eQ),er("umat2",e0),er("bmat2",e1),er("mat3",e2),er("imat3",e3),er("umat3",e4),er("bmat3",e5),er("mat4",e6),er("imat4",e9),er("umat4",e8),er("bmat4",e7),er("string",(e="")=>eE(new ee(e,"string"))),er("arrayBuffer",e=>eE(new ee(e,"ArrayBuffer"))),er("element",eR(j)),er("convert",(e,t)=>eE(new X(eE(e),t)));class te extends q{constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){let{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){let s=e.getTypeLength(t.node.getNodeType(e));return C.join("").slice(0,s)!==t.components}return!1}generate(e,t){let s;let{targetNode:r,sourceNode:i}=this,o=this.needsSplitAssign(e),a=r.getNodeType(e),n=r.context({assign:!0}).build(e),l=i.build(e,a),u=i.getNodeType(e),d=e.getDataFromNode(this);if(!0===d.initialized)"void"!==t&&(s=n);else if(o){let i=e.getVarFromNode(this,null,a),o=e.getPropertyName(i);e.addLineFlowCode(`${o} = ${l}`);let u=r.node.context({assign:!0}).build(e);for(let t=0;t<r.components.length;t++){let s=r.components[t];e.addLineFlowCode(`${u}.${s} = ${o}[ ${t} ]`)}"void"!==t&&(s=n)}else s=`${n} = ${l}`,("void"===t||"void"===u)&&(e.addLineFlowCode(s),"void"!==t&&(s=n));return d.initialized=!0,e.format(s,a,t)}}const tt=eR(te);H("AssignNode",te),er("assign",tt);class ts extends G{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){let{name:t,node:s}=this,r=this.getNodeType(e),i=e.getVaryingFromNode(this,t,r);i.needsInterpolation||(i.needsInterpolation="fragment"===e.shaderStage);let o=e.getPropertyName(i,R);return e.flowNodeFromShaderStage(R,s,r,o),e.getPropertyName(i)}}const tr=eR(ts);er("varying",tr),H("VaryingNode",ts);class ti extends G{constructor(e,t=null){super(t),this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(null===t){let s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){let r=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){let t=this.getAttributeName(e),s=this.getNodeType(e);if(!0!==e.hasGeometryAttribute(t))return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s);{let r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),o=e.getAttribute(t,i);return"vertex"===e.shaderStage?e.format(o.name,i,s):tr(this).build(e,s)}}}var to=ti;const ta=(e,t)=>eE(new ti(e,t));H("AttributeNode",ti);class tn extends G{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){let t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t),this.outputNode.build(e)}}const tl=eR(tn);er("bypass",tl),H("BypassNode",tn);let tu=0;var td=class{constructor(){this.id=tu++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}};class th extends G{constructor(e,t=new td){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){let s=e.getCache(),r=this.cache||e.globalCache;e.setCache(r);let i=this.node.build(e,...t);return e.setCache(s),i}}const tc=eR(th);er("cache",tc),er("globalCache",e=>tc(e,null)),H("CacheNode",th);class tp extends G{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=e.getContext();e.setContext({...e.context,...this.context});let s=this.node.build(e);return e.setContext(t),s}generate(e,t){let s=e.getContext();e.setContext({...e.context,...this.context});let r=this.node.build(e,t);return e.setContext(s),r}}var tm=tp;const tg=eR(tp);er("context",tg),er("label",(e,t)=>tg(e,{label:t})),H("ContextNode",tp);class tf extends G{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){let t;let s=this.getNodeType(e),r=this.scope;if(r===tf.VERTEX)t=e.getVertexIndex();else if(r===tf.INSTANCE)t=e.getInstanceIndex();else throw Error("THREE.IndexNode: Unknown scope: "+r);return"vertex"===e.shaderStage||"compute"===e.shaderStage?t:tr(this).build(e,s)}}tf.VERTEX="vertex",tf.INSTANCE="instance";const tN=eS(tf,tf.VERTEX),ty=eS(tf,tf.INSTANCE);H("IndexNode",tf);var tv=class{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}};class tT extends G{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){let{node:t,name:s}=this,r=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(r),o=t.build(e,r.type);return e.addLineFlowCode(`${i} = ${o}`),i}}const tx=eR(tT);er("temp",tx),er("toVar",(...e)=>tx(...e).append()),H("VarNode",tT);class tb extends G{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name)).needsInterpolation=!0:t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}var tw=tb;const tV=(e,t)=>eE(new tb(e,t)),t_=(e,t)=>eE(new tb(e,t,!0)),tE=eS(tb,"vec4","DiffuseColor"),tA=eS(tb,"float","Roughness"),tM=eS(tb,"float","Metalness"),tR=eS(tb,"float","Clearcoat"),tS=eS(tb,"float","ClearcoatRoughness"),tC=eS(tb,"vec3","Sheen"),tL=eS(tb,"float","SheenRoughness"),tI=eS(tb,"float","Iridescence"),tO=eS(tb,"float","IridescenceIOR"),tD=eS(tb,"float","IridescenceThickness"),tz=eS(tb,"color","SpecularColor"),tF=eS(tb,"float","Shininess"),tP=eS(tb,"vec4","Output"),tU=eS(tb,"float","dashSize"),tB=eS(tb,"float","gapSize");eS(tb,"float","pointWidth"),H("PropertyNode",tb),H("ParameterNode",class extends tw{constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}});class tG extends G{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){for(let t of this.getIncludes(e))t.build(e);let t=e.getCodeFromNode(this,this.getNodeType(e));return t.code=this.code,t.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}var tH=tG;eR(tG),H("CodeNode",tG),H("FunctionNode",class extends tH{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){let t=e.getDataFromNode(this),s=t.nodeFunction;return void 0===s&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);let s=this.getNodeFunction(e),r=s.name,i=s.type,o=e.getCodeFromNode(this,i);""!==r&&(o.name=r);let a=e.getPropertyName(o),n=this.getNodeFunction(e).getCode(a),l=this.keywords,u=Object.keys(l);if(u.length>0)for(let t of u){let s=RegExp(`\\b${t}\\b`,"g"),r=l[t].build(e,"property");n=n.replace(s,r)}return(o.code=n+"\n","property"===t)?a:e.format(`${a}()`,i,t)}});var y=f("ilwiq");class tk extends G{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){!0===e&&this.version++}}const tq=e=>new tk(e,!0);tq("frame"),tq("render");const tW=new tk("object");H("UniformGroupNode",tk);class tj extends Q{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.groupNode=tW}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){let s=this.getSelf();return e=e.bind(s),super.onUpdate(t=>{let r=e(t,s);void 0!==r&&(this.value=r)},t)}generate(e,t){let s=this.getNodeType(e),r=this.getUniformHash(e),i=e.getNodeFromHash(r);void 0===i&&(e.setHashNode(this,r),i=this);let o=i.getInputType(e),a=e.getUniformFromNode(i,o,e.shaderStage,e.context.label),n=e.getPropertyName(a);return void 0!==e.context.label&&delete e.context.label,e.format(n,s,t)}}var tX=tj;const t$=(e,t)=>{let s=eV(t||e);return eE(new tj(e&&!0===e.isNode?e.node&&e.node.value||e.value:e,s))};H("UniformNode",tj);class tY extends to{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){let e=this.index;return"uv"+(e>0?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const tJ=(...e)=>eE(new tY(...e));H("UVNode",tY);class tK extends G{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){let s=this.textureNode.build(e,"property"),r=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${r} )`,this.getNodeType(e),t)}}const tZ=eR(tK);er("textureSize",tZ),H("TextureSizeNode",tK);class tQ extends q{constructor(e,t,s,...r){if(super(),this.op=e,r.length>0){let t=s;for(let s=0;s<r.length;s++)t=new tQ(e,t,r[s]);s=t}this.aNode=t,this.bNode=s}getNodeType(e,t){let s=this.op,r=this.aNode,i=this.bNode,o=r.getNodeType(e),a=void 0!==i?i.getNodeType(e):null;if("void"===o||"void"===a)return"void";if("%"===s)return o;if("~"===s||"&"===s||"|"===s||"^"===s||">>"===s||"<<"===s)return e.getIntegerType(o);if("!"===s||"=="===s||"&&"===s||"||"===s||"^^"===s)return"bool";if("<"===s||">"===s||"<="===s||">="===s){let s=t?e.getTypeLength(t):Math.max(e.getTypeLength(o),e.getTypeLength(a));return s>1?`bvec${s}`:"bool"}return"float"===o&&e.isMatrix(a)?a:e.isMatrix(o)&&e.isVector(a)?e.getVectorFromMatrix(o):e.isVector(o)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(o)?a:o}generate(e,t){let s=this.op,r=this.aNode,i=this.bNode,o=this.getNodeType(e,t),a=null,n=null;"void"!==o?(a=r.getNodeType(e),n=void 0!==i?i.getNodeType(e):null,"<"===s||">"===s||"<="===s||">="===s||"=="===s?e.isVector(a)?n=a:a=n="float":">>"===s||"<<"===s?(a=o,n=e.changeComponentType(n,"uint")):e.isMatrix(a)&&e.isVector(n)?n=e.getVectorFromMatrix(a):a=e.isVector(a)&&e.isMatrix(n)?e.getVectorFromMatrix(n):n=o):a=n=o;let l=r.build(e,a),u=void 0!==i?i.build(e,n):null,d=e.getTypeLength(t),h=e.getFunctionOperator(s);if("void"!==t){if("<"===s&&d>1)return e.format(`${e.getMethod("lessThan")}( ${l}, ${u} )`,o,t);if("<="===s&&d>1)return e.format(`${e.getMethod("lessThanEqual")}( ${l}, ${u} )`,o,t);if(">"===s&&d>1)return e.format(`${e.getMethod("greaterThan")}( ${l}, ${u} )`,o,t);if(">="===s&&d>1)return e.format(`${e.getMethod("greaterThanEqual")}( ${l}, ${u} )`,o,t);else if("!"===s||"~"===s)return e.format(`(${s}${l})`,a,t);else if(h)return e.format(`${h}( ${l}, ${u} )`,o,t);else return e.format(`( ${l} ${s} ${u} )`,o,t)}if("void"!==a)return h?e.format(`${h}( ${l}, ${u} )`,o,t):e.format(`${l} ${s} ${u}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const t0=eR(tQ,"+"),t1=eR(tQ,"-"),t2=eR(tQ,"*"),t3=eR(tQ,"/"),t4=eR(tQ,"%"),t5=eR(tQ,"=="),t6=eR(tQ,"!="),t9=eR(tQ,"<"),t8=eR(tQ,">"),t7=eR(tQ,"<="),se=eR(tQ,">="),st=eR(tQ,"&&"),ss=eR(tQ,"||"),sr=eR(tQ,"!"),si=eR(tQ,"^^"),so=eR(tQ,"&"),sa=eR(tQ,"~"),sn=eR(tQ,"|"),sl=eR(tQ,"^"),su=eR(tQ,"<<"),sd=eR(tQ,">>");er("add",t0),er("sub",t1),er("mul",t2),er("div",t3),er("remainder",t4),er("equal",t5),er("notEqual",t6),er("lessThan",t9),er("greaterThan",t8),er("lessThanEqual",t7),er("greaterThanEqual",se),er("and",st),er("or",ss),er("not",sr),er("xor",si),er("bitAnd",so),er("bitNot",sa),er("bitOr",sn),er("bitXor",sl),er("shiftLeft",su),er("shiftRight",sd),H("OperatorNode",tQ);class sh extends q{constructor(e,t,s=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=r}getInputType(e){let t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(r)?0:e.getTypeLength(r);if(i>o&&i>a);else if(o>a)return s;else if(a>i)return r;return t}getNodeType(e){let t=this.method;return t===sh.LENGTH||t===sh.DISTANCE||t===sh.DOT?"float":t===sh.CROSS?"vec3":t===sh.ALL?"bool":t===sh.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===sh.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){let s=this.method,r=this.getNodeType(e),i=this.getInputType(e),o=this.aNode,a=this.bNode,n=this.cNode,l=!0===e.renderer.isWebGLRenderer;if(s===sh.TRANSFORM_DIRECTION){let s=o,r=a;return e.isMatrix(s.getNodeType(e))?r=e$(eq(r),0):s=e$(eq(s),0),sA(t2(s,r).xyz).build(e,t)}{if(s===sh.NEGATE)return e.format("( - "+o.build(e,i)+" )",r,t);if(s===sh.ONE_MINUS)return t1(1,o).build(e,t);if(s===sh.RECIPROCAL)return t3(1,o).build(e,t);if(s===sh.DIFFERENCE)return sD(t1(o,a)).build(e,t);let u=[];return s===sh.CROSS||s===sh.MOD?u.push(o.build(e,r),a.build(e,r)):s===sh.STEP?u.push(o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":i),a.build(e,i)):l&&(s===sh.MIN||s===sh.MAX)||s===sh.MOD?u.push(o.build(e,i),a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":i)):s===sh.REFRACT?u.push(o.build(e,i),a.build(e,i),n.build(e,"float")):s===sh.MIX?u.push(o.build(e,i),a.build(e,i),n.build(e,1===e.getTypeLength(n.getNodeType(e))?"float":i)):(u.push(o.build(e,i)),null!==a&&u.push(a.build(e,i)),null!==n&&u.push(n.build(e,i))),e.format(`${e.getMethod(s,r)}( ${u.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}sh.ALL="all",sh.ANY="any",sh.EQUALS="equals",sh.RADIANS="radians",sh.DEGREES="degrees",sh.EXP="exp",sh.EXP2="exp2",sh.LOG="log",sh.LOG2="log2",sh.SQRT="sqrt",sh.INVERSE_SQRT="inversesqrt",sh.FLOOR="floor",sh.CEIL="ceil",sh.NORMALIZE="normalize",sh.FRACT="fract",sh.SIN="sin",sh.COS="cos",sh.TAN="tan",sh.ASIN="asin",sh.ACOS="acos",sh.ATAN="atan",sh.ABS="abs",sh.SIGN="sign",sh.LENGTH="length",sh.NEGATE="negate",sh.ONE_MINUS="oneMinus",sh.DFDX="dFdx",sh.DFDY="dFdy",sh.ROUND="round",sh.RECIPROCAL="reciprocal",sh.TRUNC="trunc",sh.FWIDTH="fwidth",sh.BITCAST="bitcast",sh.ATAN2="atan2",sh.MIN="min",sh.MAX="max",sh.MOD="mod",sh.STEP="step",sh.REFLECT="reflect",sh.DISTANCE="distance",sh.DIFFERENCE="difference",sh.DOT="dot",sh.CROSS="cross",sh.POW="pow",sh.TRANSFORM_DIRECTION="transformDirection",sh.MIX="mix",sh.CLAMP="clamp",sh.REFRACT="refract",sh.SMOOTHSTEP="smoothstep",sh.FACEFORWARD="faceforward";const sc=ez(1e-6);ez(1e6);const sp=ez(Math.PI);ez(2*Math.PI);const sm=eR(sh,sh.ALL),sg=eR(sh,sh.ANY),sf=eR(sh,sh.EQUALS),sN=eR(sh,sh.RADIANS),sy=eR(sh,sh.DEGREES),sv=eR(sh,sh.EXP),sT=eR(sh,sh.EXP2),sx=eR(sh,sh.LOG),sb=eR(sh,sh.LOG2),sw=eR(sh,sh.SQRT),sV=eR(sh,sh.INVERSE_SQRT),s_=eR(sh,sh.FLOOR),sE=eR(sh,sh.CEIL),sA=eR(sh,sh.NORMALIZE),sM=eR(sh,sh.FRACT),sR=eR(sh,sh.SIN),sS=eR(sh,sh.COS),sC=eR(sh,sh.TAN),sL=eR(sh,sh.ASIN),sI=eR(sh,sh.ACOS),sO=eR(sh,sh.ATAN),sD=eR(sh,sh.ABS),sz=eR(sh,sh.SIGN),sF=eR(sh,sh.LENGTH),sP=eR(sh,sh.NEGATE),sU=eR(sh,sh.ONE_MINUS),sB=eR(sh,sh.DFDX),sG=eR(sh,sh.DFDY),sH=eR(sh,sh.ROUND),sk=eR(sh,sh.RECIPROCAL),sq=eR(sh,sh.TRUNC),sW=eR(sh,sh.FWIDTH);eR(sh,sh.BITCAST);const sj=eR(sh,sh.ATAN2),sX=eR(sh,sh.MIN),s$=eR(sh,sh.MAX),sY=eR(sh,sh.MOD),sJ=eR(sh,sh.STEP),sK=eR(sh,sh.REFLECT),sZ=eR(sh,sh.DISTANCE),sQ=eR(sh,sh.DIFFERENCE),s0=eR(sh,sh.DOT),s1=eR(sh,sh.CROSS),s2=eR(sh,sh.POW),s3=eR(sh,sh.POW,2),s4=eR(sh,sh.POW,3),s5=eR(sh,sh.POW,4),s6=eR(sh,sh.TRANSFORM_DIRECTION),s9=eR(sh,sh.MIX),s8=(e,t=0,s=1)=>eE(new sh(sh.CLAMP,eE(e),eE(t),eE(s))),s7=eR(sh,sh.REFRACT),re=eR(sh,sh.SMOOTHSTEP),rt=eR(sh,sh.FACEFORWARD);er("all",sm),er("any",sg),er("equals",sf),er("radians",sN),er("degrees",sy),er("exp",sv),er("exp2",sT),er("log",sx),er("log2",sb),er("sqrt",sw),er("inverseSqrt",sV),er("floor",s_),er("ceil",sE),er("normalize",sA),er("fract",sM),er("sin",sR),er("cos",sS),er("tan",sC),er("asin",sL),er("acos",sI),er("atan",sO),er("abs",sD),er("sign",sz),er("length",sF),er("lengthSq",e=>s0(e,e)),er("negate",sP),er("oneMinus",sU),er("dFdx",sB),er("dFdy",sG),er("round",sH),er("reciprocal",sk),er("trunc",sq),er("fwidth",sW),er("atan2",sj),er("min",sX),er("max",s$),er("mod",sY),er("step",sJ),er("reflect",sK),er("distance",sZ),er("dot",s0),er("cross",s1),er("pow",s2),er("pow2",s3),er("pow3",s4),er("pow4",s5),er("transformDirection",s6),er("mix",(e,t,s)=>s9(t,s,e)),er("clamp",s8),er("refract",s7),er("smoothstep",(e,t,s)=>re(t,s,e)),er("faceForward",rt),er("difference",sQ),er("saturate",e=>s8(e)),er("cbrt",e=>t2(sz(e),s2(sD(e),1/3))),H("MathNode",sh);var y=f("ilwiq");const rs=eC(e=>{let{value:t}=e,{rgb:s}=t;return e$(s9(s.mul(.9478672986).add(.0521327014).pow(2.4),s.mul(.0773993808),s.lessThanEqual(.04045)),t.a)}),rr=eC(e=>{let{value:t}=e,{rgb:s}=t;return e$(s9(s.pow(.41666).mul(1.055).sub(.055),s.mul(12.92),s.lessThanEqual(.0031308)),t.a)}),ri=e=>{let t=null;return e===y.LinearSRGBColorSpace?t="Linear":e===y.SRGBColorSpace&&(t="sRGB"),t},ro=(e,t)=>ri(e)+"To"+ri(t);class ra extends q{constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){let{method:e,node:t}=this;return e===ra.LINEAR_TO_LINEAR?t:rn[e]({value:t})}}ra.LINEAR_TO_LINEAR="LinearToLinear",ra.LINEAR_TO_sRGB="LinearTosRGB",ra.sRGB_TO_LINEAR="sRGBToLinear";const rn={[ra.LINEAR_TO_sRGB]:rr,[ra.sRGB_TO_LINEAR]:rs},rl=(e,t)=>eE(new ra(ro(t,y.LinearSRGBColorSpace),eE(e))),ru=eR(ra,ra.LINEAR_TO_sRGB),rd=eR(ra,ra.sRGB_TO_LINEAR);er("linearTosRGB",ru),er("sRGBToLinear",rd),er("linearToColorSpace",(e,t)=>eE(new ra(ro(y.LinearSRGBColorSpace,t),eE(e)))),er("colorSpaceToLinear",rl),H("ColorSpaceNode",ra);class rh extends G{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){let s=this.getNodeType(e),r=this.snippet;if("void"!==s)return e.format(`( ${r} )`,s,t);e.addLineFlowCode(r)}}const rc=eR(rh);H("ExpressionNode",rh);class rp extends tX{constructor(e){super(0),this.textureNode=e,this.updateType=S.FRAME}get texture(){return this.textureNode.value}update(){let e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&void 0!==s.width){let{width:e,height:t}=s;this.value=Math.log2(Math.max(e,t))}}}const rm=eR(rp);H("MaxMipLevelNode",rp);class rg extends tX{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=S.NONE,this.referenceNode=null,this._value=e,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return tJ(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return t$(this.value.matrix).mul(eq(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?S.FRAME:S.NONE,this}setupUV(e,t){let s=this.value;return e.isFlipY()&&(!0===s.isRenderTargetTexture||!0===s.isFramebufferTexture||!0===s.isDepthTexture)&&(t=t.setY(t.y.oneMinus())),t}setup(e){let t=e.getNodeProperties(this),s=this.uvNode;(null===s||!0===e.context.forceUVContext)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),!0===this.updateMatrix&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let r=this.levelNode;null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=r,t.compareNode=this.compareNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,t,s,r,i,o){let a=this.value;return r?e.generateTextureLevel(a,t,s,r,i):o?e.generateTextureCompare(a,t,s,o,i):!1===this.sampler?e.generateTextureLoad(a,t,s,i):e.generateTexture(a,t,s,i)}generate(e,t){let s=e.getNodeProperties(this),r=this.value;if(!r||!0!==r.isTexture)throw Error("TextureNode: Need a three.js texture.");let i=super.generate(e,"property");if("sampler"===t)return i+"_sampler";{if(e.isReference(t))return i;let o=e.getDataFromNode(this),a=o.propertyName;if(void 0===a){let{uvNode:t,levelNode:r,compareNode:n,depthNode:l}=s,u=this.generateUV(e,t),d=r?r.build(e,"float"):null,h=l?l.build(e,"int"):null,c=n?n.build(e,"float"):null,p=e.getVarFromNode(this);a=e.getPropertyName(p);let m=this.generateSnippet(e,i,u,d,h,c);e.addLineFlowCode(`${a} = ${m}`),!1!==e.context.tempWrite&&(o.snippet=m,o.propertyName=a)}let n=a,l=this.getNodeType(e);return e.needsColorSpaceToLinear(r)&&(n=rl(rc(n,l),r.colorSpace).setup(e).build(e,l)),e.format(n,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){let t=this.clone();return t.uvNode=e,t.referenceNode=this,eE(t)}blur(e){let t=this.clone();return t.levelNode=e.mul(rm(t)),t.referenceNode=this,eE(t)}level(e){let t=this.clone();return t.levelNode=e,t.referenceNode=this,t}size(e){return tZ(this,e)}compare(e){let t=this.clone();return t.compareNode=eE(e),t.referenceNode=this,eE(t)}depth(e){let t=this.clone();return t.depthNode=eE(e),t.referenceNode=this,eE(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){let e=this.value;!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){let e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}var rf=rg;const rN=eR(rg),ry=(...e)=>rN(...e).setSampler(!1);er("texture",rN),H("TextureNode",rg);class rv extends tX{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getInputType(){return"buffer"}}var rT=rv;const rx=(e,t,s)=>eE(new rv(e,t,s));H("BufferNode",rv);class rb extends j{constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){let t=super.generate(e),s=this.getNodeType();return e.format(t,"vec4",s)}}class rw extends rT{constructor(e,t=null){super(null,"vec4"),this.array=e,this.elementType=t,this._elementType=null,this._elementLength=0,this.updateType=S.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){let{array:e,value:t}=this,s=this.getElementLength(),r=this.getElementType();if(1===s)for(let s=0;s<e.length;s++)t[4*s]=e[s];else if("color"===r)for(let s=0;s<e.length;s++){let r=4*s,i=e[s];t[r]=i.r,t[r+1]=i.g,t[r+2]=i.b||0}else for(let s=0;s<e.length;s++){let r=4*s,i=e[s];t[r]=i.x,t[r+1]=i.y,t[r+2]=i.z||0,t[r+3]=i.w||0}}setup(e){let t=this.array.length;return this._elementType=null===this.elementType?O(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType),this.value=new Float32Array(4*t),this.bufferCount=t,super.setup(e)}element(e){return eE(new rb(this,eE(e)))}}const rV=(e,t)=>eE(new rw(e,t));H("UniformsNode",rw);class r_ extends j{constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let t=super.generate(e),s=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,s,r)}}class rE extends G{constructor(e,t,s=null,r=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=r,this.properties=e.split("."),this.reference=null,this.node=null,this.updateType=S.OBJECT}element(e){return eE(new r_(this,eE(e)))}setNodeType(e){let t=null;t=null!==this.count?rx(null,e,this.count):Array.isArray(this.getValueFromReference())?rV(null,e):"texture"===e?rN(null):t$(null,e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:t}=this,s=e[t[0]];for(let e=1;e<t.length;e++)s=s[t[e]];return s}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}var rA=rE;const rM=(e,t,s)=>eE(new rE(e,t,s)),rR=(e,t,s,r)=>eE(new rE(e,t,r,s));H("ReferenceNode",rE);class rS extends rA{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}const rC=(e,t,s)=>eE(new rS(e,t,s));H("MaterialReferenceNode",rS);var y=f("ilwiq");class rL extends G{constructor(e=rL.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=S.OBJECT,this._uniformNode=new tX(null)}getNodeType(){let e=this.scope;return e===rL.WORLD_MATRIX||e===rL.VIEW_MATRIX?"mat4":e===rL.NORMAL_MATRIX?"mat3":e===rL.POSITION||e===rL.VIEW_POSITION||e===rL.DIRECTION||e===rL.SCALE?"vec3":void 0}update(e){let t=this.object3d,s=this._uniformNode,r=this.scope;if(r===rL.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(r===rL.NORMAL_MATRIX)s.value=t.normalMatrix;else if(r===rL.WORLD_MATRIX)s.value=t.matrixWorld;else if(r===rL.POSITION)s.value=s.value||new y.Vector3,s.value.setFromMatrixPosition(t.matrixWorld);else if(r===rL.SCALE)s.value=s.value||new y.Vector3,s.value.setFromMatrixScale(t.matrixWorld);else if(r===rL.DIRECTION)s.value=s.value||new y.Vector3,t.getWorldDirection(s.value);else if(r===rL.VIEW_POSITION){let r=e.camera;s.value=s.value||new y.Vector3,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(r.matrixWorldInverse)}}generate(e){let t=this.scope;return t===rL.WORLD_MATRIX||t===rL.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===rL.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===rL.POSITION||t===rL.VIEW_POSITION||t===rL.DIRECTION||t===rL.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}rL.VIEW_MATRIX="viewMatrix",rL.NORMAL_MATRIX="normalMatrix",rL.WORLD_MATRIX="worldMatrix",rL.POSITION="position",rL.SCALE="scale",rL.VIEW_POSITION="viewPosition",rL.DIRECTION="direction";var rI=rL;eR(rL,rL.DIRECTION),eR(rL,rL.VIEW_MATRIX),eR(rL,rL.NORMAL_MATRIX),eR(rL,rL.WORLD_MATRIX);const rO=eR(rL,rL.POSITION);eR(rL,rL.SCALE);const rD=eR(rL,rL.VIEW_POSITION);H("Object3DNode",rL);class rz extends rI{constructor(e=rz.POSITION){super(e),this.updateType=S.RENDER}getNodeType(e){let t=this.scope;return t===rz.PROJECTION_MATRIX||t===rz.PROJECTION_MATRIX_INVERSE?"mat4":t===rz.NEAR||t===rz.FAR||t===rz.LOG_DEPTH?"float":super.getNodeType(e)}update(e){let t=e.camera,s=this._uniformNode,r=this.scope;r===rz.VIEW_MATRIX?s.value=t.matrixWorldInverse:r===rz.PROJECTION_MATRIX?s.value=t.projectionMatrix:r===rz.PROJECTION_MATRIX_INVERSE?s.value=t.projectionMatrixInverse:r===rz.NEAR?s.value=t.near:r===rz.FAR?s.value=t.far:r===rz.LOG_DEPTH?s.value=2/(Math.log(t.far+1)/Math.LN2):(this.object3d=t,super.update(e))}generate(e){let t=this.scope;return t===rz.PROJECTION_MATRIX||t===rz.PROJECTION_MATRIX_INVERSE?this._uniformNode.nodeType="mat4":(t===rz.NEAR||t===rz.FAR||t===rz.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(e)}}rz.PROJECTION_MATRIX="projectionMatrix",rz.PROJECTION_MATRIX_INVERSE="projectionMatrixInverse",rz.NEAR="near",rz.FAR="far",rz.LOG_DEPTH="logDepth";const rF=eS(rz,rz.PROJECTION_MATRIX);eS(rz,rz.PROJECTION_MATRIX_INVERSE);const rP=eS(rz,rz.NEAR),rU=eS(rz,rz.FAR),rB=eS(rz,rz.LOG_DEPTH),rG=eS(rz,rz.VIEW_MATRIX);eS(rz,rz.NORMAL_MATRIX),eS(rz,rz.WORLD_MATRIX),eS(rz,rz.POSITION),H("CameraNode",rz);class rH extends rI{constructor(e=rH.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}eS(rH,rH.DIRECTION);const rk=eS(rH,rH.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),rq=eS(rH,rH.NORMAL_MATRIX),rW=eS(rH,rH.WORLD_MATRIX);eS(rH,rH.POSITION),eS(rH,rH.SCALE),eS(rH,rH.VIEW_POSITION),H("ModelNode",rH);class rj extends G{constructor(e=rj.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(e){let t=this.scope,s=null;return t===rj.GEOMETRY?s=!1===e.hasGeometryAttribute("normal")?eq(0,1,0):ta("normal","vec3"):t===rj.LOCAL?s=tr(rX):t===rj.VIEW?s=sA(tr(rq.mul(r$))):t===rj.WORLD&&(s=sA(tr(rY.transformDirection(rG)))),s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}rj.GEOMETRY="geometry",rj.LOCAL="local",rj.VIEW="view",rj.WORLD="world";const rX=eS(rj,rj.GEOMETRY),r$=eS(rj,rj.LOCAL).temp("Normal"),rY=eS(rj,rj.VIEW),rJ=eS(rj,rj.WORLD),rK=tV("vec3","TransformedNormalView"),rZ=rK.transformDirection(rG).normalize(),rQ=tV("vec3","TransformedClearcoatNormalView");H("NormalNode",rj);const r0=new Map;class r1 extends G{constructor(e){super(),this.scope=e}getCache(e,t){let s=r0.get(e);return void 0===s&&(s=rC(e,t),r0.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){let t=e.context.material,s=this.scope,r=null;if(s===r1.COLOR){let e=this.getColor(s);r=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(s===r1.OPACITY){let e=this.getFloat(s);r=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(s===r1.SPECULAR_STRENGTH)r=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture(s).r:ez(1);else if(s===r1.ROUGHNESS){let e=this.getFloat(s);r=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(s).g):e}else if(s===r1.METALNESS){let e=this.getFloat(s);r=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(s).b):e}else if(s===r1.EMISSIVE){let e=this.getColor(s);r=t.emissiveMap&&!0===t.emissiveMap.isTexture?e.mul(this.getTexture(s)):e}else if(s===r1.NORMAL)r=t.normalMap?this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):rY;else if(s===r1.CLEARCOAT){let e=this.getFloat(s);r=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(s).r):e}else if(s===r1.CLEARCOAT_ROUGHNESS){let e=this.getFloat(s);r=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(s).r):e}else if(s===r1.CLEARCOAT_NORMAL)r=t.clearcoatNormalMap?this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):rY;else if(s===r1.SHEEN){let e=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(s===r1.SHEEN_ROUGHNESS){let e=this.getFloat(s);r=(r=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(s).a):e).clamp(.07,1)}else if(s===r1.IRIDESCENCE_THICKNESS){let e=rM("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){let i=rM("0","float",t.iridescenceThicknessRange);r=e.sub(i).mul(this.getTexture(s).g).add(i)}else r=e}else{let t=this.getNodeType(e);r=this.getCache(s,t)}return r}}r1.ALPHA_TEST="alphaTest",r1.COLOR="color",r1.OPACITY="opacity",r1.SHININESS="shininess",r1.SPECULAR_COLOR="specular",r1.SPECULAR_STRENGTH="specularStrength",r1.REFLECTIVITY="reflectivity",r1.ROUGHNESS="roughness",r1.METALNESS="metalness",r1.NORMAL="normal",r1.CLEARCOAT="clearcoat",r1.CLEARCOAT_ROUGHNESS="clearcoatRoughness",r1.CLEARCOAT_NORMAL="clearcoatNormal",r1.EMISSIVE="emissive",r1.ROTATION="rotation",r1.SHEEN="sheen",r1.SHEEN_ROUGHNESS="sheenRoughness",r1.IRIDESCENCE="iridescence",r1.IRIDESCENCE_IOR="iridescenceIOR",r1.IRIDESCENCE_THICKNESS="iridescenceThickness",r1.LINE_SCALE="scale",r1.LINE_DASH_SIZE="dashSize",r1.LINE_GAP_SIZE="gapSize",r1.LINE_WIDTH="linewidth",r1.LINE_DASH_OFFSET="dashOffset",r1.POINT_WIDTH="pointWidth";const r2=eS(r1,r1.ALPHA_TEST),r3=eS(r1,r1.COLOR),r4=eS(r1,r1.SHININESS),r5=eS(r1,r1.EMISSIVE),r6=eS(r1,r1.OPACITY),r9=eS(r1,r1.SPECULAR_COLOR),r8=eS(r1,r1.SPECULAR_STRENGTH);eS(r1,r1.REFLECTIVITY);const r7=eS(r1,r1.ROUGHNESS),ie=eS(r1,r1.METALNESS),it=eS(r1,r1.NORMAL),is=eS(r1,r1.CLEARCOAT),ir=eS(r1,r1.CLEARCOAT_ROUGHNESS),ii=eS(r1,r1.CLEARCOAT_NORMAL),io=eS(r1,r1.ROTATION),ia=eS(r1,r1.SHEEN),il=eS(r1,r1.SHEEN_ROUGHNESS),iu=eS(r1,r1.IRIDESCENCE),id=eS(r1,r1.IRIDESCENCE_IOR),ih=eS(r1,r1.IRIDESCENCE_THICKNESS),ic=eS(r1,r1.LINE_SCALE),ip=eS(r1,r1.LINE_DASH_SIZE),im=eS(r1,r1.LINE_GAP_SIZE),ig=eS(r1,r1.LINE_WIDTH),iN=eS(r1,r1.LINE_DASH_OFFSET),iy=eS(r1,r1.POINT_WIDTH);H("MaterialNode",r1);class iv extends G{constructor(e=iv.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(e){let t=this.scope,s=null;return t===iv.GEOMETRY?s=ta("position","vec3"):t===iv.LOCAL?s=tr(iT):t===iv.WORLD?s=tr(rW.mul(ix)):t===iv.VIEW?s=tr(rk.mul(ix)):t===iv.VIEW_DIRECTION?s=sA(tr(iV.negate())):t===iv.WORLD_DIRECTION&&(s=sA(tr(ix.transformDirection(rW)))),s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}iv.GEOMETRY="geometry",iv.LOCAL="local",iv.WORLD="world",iv.WORLD_DIRECTION="worldDirection",iv.VIEW="view",iv.VIEW_DIRECTION="viewDirection";const iT=eS(iv,iv.GEOMETRY),ix=eS(iv,iv.LOCAL).temp("Position"),ib=eS(iv,iv.WORLD),iw=eS(iv,iv.WORLD_DIRECTION),iV=eS(iv,iv.VIEW),i_=eS(iv,iv.VIEW_DIRECTION);H("PositionNode",iv);class iE extends q{constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if("fragment"===e.shaderStage)return tr(e.context.mvp);let t=this.positionNode||ix;return rF.mul(rk).mul(t)}}const iA=eR(iE);H("ModelViewProjectionNode",iE);var y=f("ilwiq");class iM extends Q{constructor(e,t=null,s=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=r,this.usage=y.StaticDrawUsage,this.instanced=!1,this.attribute=null,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;let t=this.getNodeType(e),s=this.value,r=e.getTypeLength(t),i=this.bufferStride||r,o=this.bufferOffset,a=!0===s.isInterleavedBuffer?s:new y.InterleavedBuffer(s,i),n=new y.InterleavedBufferAttribute(a,r,o);a.setUsage(this.usage),this.attribute=n,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){let t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(s),i=null;return"vertex"===e.shaderStage||"compute"===e.shaderStage?(this.name=r,i=r):i=tr(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const iR=(e,t,s,r)=>eE(new iM(e,t,s,r)),iS=(e,t,s,r)=>iR(e,t,s,r).setUsage(y.DynamicDrawUsage),iC=(e,t,s,r)=>iR(e,t,s,r).setInstanced(!0),iL=(e,t,s,r)=>iS(e,t,s,r).setInstanced(!0);er("toAttribute",e=>iR(e.value)),H("BufferAttributeNode",iM);var y=f("ilwiq");class iI extends G{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null}setup(){let e=this.instanceMatrixNode,t=this.instanceMesh;if(null===e){let s=t.instanceMatrix,r=new y.InstancedInterleavedBuffer(s.array,16,1),i=s.usage===y.DynamicDrawUsage?iL:iC;e=e6(i(r,"vec4",16,0),i(r,"vec4",16,4),i(r,"vec4",16,8),i(r,"vec4",16,12)),this.instanceMatrixNode=e}let s=t.instanceColor;if(s&&null===this.instanceColorNode){let e=new y.InstancedBufferAttribute(s.array,3),t=s.usage===y.DynamicDrawUsage?iL:iC;this.instanceColorNode=eq(t(e,"vec3",3,0))}let r=e.mul(ix).xyz,i=e2(e[0].xyz,e[1].xyz,e[2].xyz),o=r$.div(eq(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2]))),a=i.mul(o).xyz;ix.assign(r),r$.assign(a),null!==this.instanceColorNode&&t_("vec3","vInstanceColor").assign(this.instanceColorNode)}}const iO=eR(iI);H("InstanceNode",iI);class iD extends G{constructor(e=iD.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===iD.GEOMETRY?"vec4":"vec3"}generate(e){let t=this.scope,s=null;return t===iD.GEOMETRY?(s=ta("tangent","vec4"),!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents()):t===iD.LOCAL?s=tr(iz.xyz):t===iD.VIEW?s=sA(tr(rk.mul(e$(iF,0)).xyz)):t===iD.WORLD&&(s=sA(tr(iP.transformDirection(rG)))),s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}iD.GEOMETRY="geometry",iD.LOCAL="local",iD.VIEW="view",iD.WORLD="world";const iz=eS(iD,iD.GEOMETRY),iF=eS(iD,iD.LOCAL),iP=eS(iD,iD.VIEW),iU=eS(iD,iD.WORLD),iB=tx(iP,"TransformedTangentView");sA(iB.transformDirection(rG)),H("TangentNode",iD);class iG extends G{constructor(e){super("void"),this.batchMesh=e,this.instanceColorNode=null,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(this.batchingIdNode=ta("batchId"));let t=this.batchMesh._matricesTexture,s=tZ(ry(t),0),r=ez(eF(this.batchingIdNode)).mul(4).toVar(),i=eF(r.mod(s)),o=eF(r).div(eF(s)),a=e6(ry(t,eG(i,o)),ry(t,eG(i.add(1),o)),ry(t,eG(i.add(2),o)),ry(t,eG(i.add(3),o))),n=e2(a[0].xyz,a[1].xyz,a[2].xyz);ix.assign(a.mul(ix));let l=r$.div(eq(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2]))),u=n.mul(l).xyz;r$.assign(u),e.hasGeometryAttribute("tangent")&&iF.mulAssign(n)}}const iH=eR(iG);H("batch",iG);class ik extends G{constructor(e,t=!1){let s,r,i;super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=S.OBJECT,this.skinIndexNode=ta("skinIndex","uvec4"),this.skinWeightNode=ta("skinWeight","vec4"),t?(s=rM("bindMatrix","mat4"),r=rM("bindMatrixInverse","mat4"),i=rR("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(s=t$(e.bindMatrix,"mat4"),r=t$(e.bindMatrixInverse,"mat4"),i=rx(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=r,this.boneMatricesNode=i}setup(e){let{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:r,bindMatrixInverseNode:i,boneMatricesNode:o}=this,a=o.element(t.x),n=o.element(t.y),l=o.element(t.z),u=o.element(t.w),d=r.mul(ix),h=t0(a.mul(s.x).mul(d),n.mul(s.y).mul(d),l.mul(s.z).mul(d),u.mul(s.w).mul(d)),c=i.mul(h).xyz,p=t0(s.x.mul(a),s.y.mul(n),s.z.mul(l),s.w.mul(u)),m=(p=i.mul(p).mul(r)).transformDirection(r$).xyz;ix.assign(c),r$.assign(m),e.hasGeometryAttribute("tangent")&&iF.assign(m)}generate(e,t){if("void"!==t)return ix.build(e,t)}update(e){(this.useReference?e.object:this.skinnedMesh).skeleton.update()}}const iq=e=>eE(new ik(e,!0));H("SkinningNode",ik);var y=f("ilwiq");class iW extends G{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt()+e)}getProperties(e){let t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;let s={};for(let e=0,t=this.params.length-1;e<t;e++){let t=this.params[e],r=!0!==t.isNode&&t.name||this.getVarName(e),i=!0!==t.isNode&&t.type||"int";s[r]=rc(r,i)}return t.returnsNode=this.params[this.params.length-1](s,e.addStack(),e),t.stackNode=e.removeStack(),t}getNodeType(e){let{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){let t=this.getProperties(e),s=this.params,r=t.stackNode;for(let t=0,r=s.length-1;t<r;t++){let r=s[t],i=null,o=null,a=null,n=null,l=null,u=null;r.isNode?(n="int",a=this.getVarName(t),i="0",o=r.build(e,n),l="<"):(n=r.type||"int",a=r.name||this.getVarName(t),i=r.start,o=r.end,l=r.condition,u=r.update,"number"==typeof i?i=i.toString():i&&i.isNode&&(i=i.build(e,n)),"number"==typeof o?o=o.toString():o&&o.isNode&&(o=o.build(e,n)),void 0!==i&&void 0===o?(i+=" - 1",o="0",l=">="):void 0!==o&&void 0===i&&(i="0",l="<"),void 0===l&&(l=Number(i)>Number(o)?">=":"<"));let d={start:i,end:o},h=d.start,c=d.end,p="",m="",g="";u||(u="int"===n||"uint"===n?l.includes("<")?"++":"--":l.includes("<")?"+= 1.":"-= 1."),p+=e.getVar(n,a)+" = "+h,m+=a+" "+l+" "+c,g+=a+" "+u;let f=`for ( ${p}; ${m}; ${g} )`;e.addFlowCode((0===t?"\n":"")+e.tab+f+" {\n\n").addFlowTab()}let i=tg(r,{tempWrite:!1}).build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+i);for(let t=0,s=this.params.length-1;t<s;t++)e.addFlowCode((0===t?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),o}}const ij=(...e)=>eE(new iW(eM(e,"int"))).append(),iX=()=>rc("break").append();er("loop",(e,...t)=>tl(e,ij(...t))),H("LoopNode",iW);const i$=new WeakMap,iY=new y.Vector4,iJ=eC(({bufferMap:e,influence:t,stride:s,width:r,depth:i,offset:o})=>{let a=eF(tN).mul(s).add(o),n=a.div(r);return ry(e,eG(a.sub(n.mul(r)),n)).depth(i).mul(t)});class iK extends G{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=t$(1),this.updateType=S.OBJECT}setup(e){let{geometry:t}=e,s=void 0!==t.morphAttributes.position,r=void 0!==t.morphAttributes.normal,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=void 0!==i?i.length:0,{texture:a,stride:n,size:l}=function(e){let t=void 0!==e.morphAttributes.position,s=void 0!==e.morphAttributes.normal,r=void 0!==e.morphAttributes.color,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,o=void 0!==i?i.length:0,a=i$.get(e);if(void 0===a||a.count!==o){void 0!==a&&a.texture.dispose();let i=e.morphAttributes.position||[],n=e.morphAttributes.normal||[],l=e.morphAttributes.color||[],u=0;!0===t&&(u=1),!0===s&&(u=2),!0===r&&(u=3);let d=e.attributes.position.count*u,h=1;d>4096&&(h=Math.ceil(d/4096),d=4096);let c=new Float32Array(d*h*4*o),p=new y.DataArrayTexture(c,d,h,o);p.type=y.FloatType,p.needsUpdate=!0;let m=4*u;for(let e=0;e<o;e++){let o=i[e],a=n[e],u=l[e],p=d*h*4*e;for(let e=0;e<o.count;e++){let i=e*m;!0===t&&(iY.fromBufferAttribute(o,e),c[p+i+0]=iY.x,c[p+i+1]=iY.y,c[p+i+2]=iY.z,c[p+i+3]=0),!0===s&&(iY.fromBufferAttribute(a,e),c[p+i+4]=iY.x,c[p+i+5]=iY.y,c[p+i+6]=iY.z,c[p+i+7]=0),!0===r&&(iY.fromBufferAttribute(u,e),c[p+i+8]=iY.x,c[p+i+9]=iY.y,c[p+i+10]=iY.z,c[p+i+11]=4===u.itemSize?iY.w:1)}}a={count:o,texture:p,stride:u,size:new y.Vector2(d,h)},i$.set(e,a),e.addEventListener("dispose",function t(){p.dispose(),i$.delete(e),e.removeEventListener("dispose",t)})}return a}(t);!0===s&&ix.mulAssign(this.morphBaseInfluence),!0===r&&r$.mulAssign(this.morphBaseInfluence);let u=eF(l.width);ij(o,({i:e})=>{let t=ez(0).toVar();!0===this.mesh.isInstancedMesh&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?t.assign(ry(this.mesh.morphTexture,eG(eF(e).add(1),eF(ty))).r):t.assign(rM("morphTargetInfluences","float").element(e).toVar()),!0===s&&ix.addAssign(iJ({bufferMap:a,influence:t,stride:n,width:u,depth:e,offset:eF(0)})),!0===r&&r$.addAssign(iJ({bufferMap:a,influence:t,stride:n,width:u,depth:e,offset:eF(1)}))})}update(){let e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}const iZ=eR(iK);H("MorphNode",iK);class iQ extends G{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return i_.negate().reflect(rK).transformDirection(rG)}}const i0=eS(iQ);H("ReflectVectorNode",iQ);var y=f("ilwiq");class i1 extends rf{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return i0}setUpdateMatrix(){}setupUV(e,t){let s=this.value;return e.renderer.coordinateSystem!==y.WebGPUCoordinateSystem&&s.isRenderTargetTexture?t:eq(t.x.negate(),t.yz)}generateUV(e,t){return t.build(e,"vec3")}}const i2=eR(i1);er("cubeTexture",i2),H("CubeTextureNode",i1);class i3 extends G{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}var i4=i3;H("LightingNode",i3);var y=f("ilwiq");let i5=null;class i6 extends i4{constructor(e=null){super(),this.updateType=S.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.color=new y.Color,this._defaultColorNode=t$(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+this.light.id+"-"+(this.light.castShadow?"1":"0")}getHash(){return this.light.uuid}setupShadow(e){let t=this.shadowNode;if(null===t){let s,r;null===i5&&((i5=e.createNodeMaterial()).fragmentNode=e$(0,0,0,1),i5.isShadowNodeMaterial=!0);let i=this.light.shadow,o=e.createRenderTarget(i.mapSize.width,i.mapSize.height),a=new y.DepthTexture;a.minFilter=y.NearestFilter,a.magFilter=y.NearestFilter,a.image.width=i.mapSize.width,a.image.height=i.mapSize.height,a.compareFunction=y.LessCompare,o.depthTexture=a,i.camera.updateProjectionMatrix();let n=rM("bias","float",i),l=rM("normalBias","float",i),u=t$(i.matrix).mul(ib.add(rJ.mul(l))),d=(u=u.xyz.div(u.w)).x.greaterThanEqual(0).and(u.x.lessThanEqual(1)).and(u.y.greaterThanEqual(0)).and(u.y.lessThanEqual(1)).and(u.z.lessThanEqual(1)),h=u.z.add(n);e.renderer.coordinateSystem===y.WebGPUCoordinateSystem&&(h=h.mul(2).sub(1)),s=(u=eq(u.x,u.y.oneMinus(),h)).xy,r=u.z,t=rN(a,s).compare(r);let c=rN(o.texture,u);this.rtt=o,this.colorNode=this.colorNode.mul(d.mix(1,t.mix(c.a.mix(1,c),1))),this.shadowNode=t,this.updateBeforeType=S.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):null!==this.shadowNode&&this.disposeShadow()}updateShadow(e){let{rtt:t,light:s}=this,{renderer:r,scene:i}=e,o=i.overrideMaterial;i.overrideMaterial=i5,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s);let a=r.getRenderTarget(),n=r.getRenderObjectFunction();r.setRenderObjectFunction((e,...t)=>{!0===e.castShadow&&r.renderObject(e,...t)}),r.setRenderTarget(t),r.render(i,s.shadow.camera),r.setRenderTarget(a),r.setRenderObjectFunction(n),i.overrideMaterial=o}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){let{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){let{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}var i9=i6;H("AnalyticLightNode",i6);const i8=new WeakMap,i7=e=>e.sort((e,t)=>e.id-t.id),oe=eR(class extends G{constructor(e=[]){super("vec3"),this.totalDiffuseNode=eq().temp("totalDiffuse"),this.totalSpecularNode=eq().temp("totalSpecular"),this.outgoingLightNode=eq().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(null===this._hash){let e=[];for(let t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}setup(e){let t=e.context,s=t.lightingModel,r=this.outgoingLightNode;if(s){let{lightNodes:i,totalDiffuseNode:o,totalSpecularNode:a}=this;t.outgoingLight=r;let n=e.addStack();for(let r of(s.start(t,n,e),i))r.build(e);s.indirectDiffuse(t,n,e),s.indirectSpecular(t,n,e),s.ambientOcclusion(t,n,e);let{backdrop:l,backdropAlpha:u}=t,{directDiffuse:d,directSpecular:h,indirectDiffuse:c,indirectSpecular:p}=t.reflectedLight,m=d.add(c);null!==l&&(m=eq(null!==u?u.mix(m,l):l)),o.assign(m),a.assign(h.add(p)),r.assign(o.add(a)),s.finish(t,n,e),r=r.bypass(e.removeStack())}return r}_getLightNodeById(e){for(let t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){let t=[];for(let s of e=i7(e)){let e=this._getLightNodeById(s.id);if(null===e){let t=s.constructor;e=eE(new(i8.has(t)?i8.get(t):i9)(s))}t.push(e)}return this.lightNodes=t,this._hash=null,this}});function ot(e,t){if(i8.has(e)){console.warn(`Redefinition of light node ${t.type}`);return}if("function"!=typeof e)throw Error(`Light ${e.name} is not a class`);if("function"!=typeof t||!t.type)throw Error(`Light node ${t.type} is not a class`);i8.set(e,t)}class os extends i4{constructor(e=null){super(),this.aoNode=e}setup(e){let t=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(t)}}H("AONode",os);class or extends tm{constructor(e,t=null,s=null,r=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=r,this._context=null}getContext(){let{backdropNode:e,backdropAlphaNode:t}=this,s=eq().temp("directDiffuse"),r=eq().temp("directSpecular"),i=eq().temp("indirectDiffuse"),o=eq().temp("indirectSpecular");return{radiance:eq().temp("radiance"),irradiance:eq().temp("irradiance"),iblIrradiance:eq().temp("iblIrradiance"),ambientOcclusion:ez(1).temp("ambientOcclusion"),reflectedLight:{directDiffuse:s,directSpecular:r,indirectDiffuse:i,indirectSpecular:o},backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const oi=eR(or);er("lightingContext",oi),H("LightingContextNode",or);class oo extends G{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){let t=this.ifNode.getNodeType(e);if(null!==this.elseNode){let s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}generate(e,t){let s=this.getNodeType(e),r={tempWrite:!1},i=e.getDataFromNode(this);if(void 0!==i.nodeProperty)return i.nodeProperty;let{ifNode:o,elseNode:a}=this,n="void"!==t,l=n?tV(s).build(e):"";i.nodeProperty=l;let u=tg(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${u} ) {

`).addFlowTab();let d=tg(o,r).build(e,s);if(d&&(d=n?l+" = "+d+";":"return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+"\n\n"+e.tab+"}"),null!==a){e.addFlowCode(" else {\n\n").addFlowTab();let t=tg(a,r).build(e,s);t&&(t=n?l+" = "+t+";":"return "+t+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(l,s,t)}}var oa=oo;const on=eR(oo);er("cond",on),H("CondNode",oo);const ol=ez(1),ou=ez(-2),od=ez(.8),oh=ez(-1),oc=ez(.4),op=ez(2),om=ez(.305),og=ez(3),of=ez(.21),oN=ez(4),oy=ez(4),ov=ez(16),oT=eC(([e])=>{let t=eq(sD(e)).toVar(),s=ez(-1).toVar();return eO(t.x.greaterThan(t.z),()=>{eO(t.x.greaterThan(t.y),()=>{s.assign(on(e.x.greaterThan(0),0,3))}).else(()=>{s.assign(on(e.y.greaterThan(0),1,4))})}).else(()=>{eO(t.z.greaterThan(t.y),()=>{s.assign(on(e.z.greaterThan(0),2,5))}).else(()=>{s.assign(on(e.y.greaterThan(0),1,4))})}),s}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),ox=eC(([e,t])=>{let s=eB().toVar();return eO(t.equal(0),()=>{s.assign(eB(e.z,e.y).div(sD(e.x)))}).elseif(t.equal(1),()=>{s.assign(eB(e.x.negate(),e.z.negate()).div(sD(e.y)))}).elseif(t.equal(2),()=>{s.assign(eB(e.x.negate(),e.y).div(sD(e.z)))}).elseif(t.equal(3),()=>{s.assign(eB(e.z.negate(),e.y).div(sD(e.x)))}).elseif(t.equal(4),()=>{s.assign(eB(e.x.negate(),e.z).div(sD(e.y)))}).else(()=>{s.assign(eB(e.x,e.y).div(sD(e.z)))}),t2(.5,s.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),ob=eC(([e])=>{let t=ez(0).toVar();return eO(e.greaterThanEqual(od),()=>{t.assign(ol.sub(e).mul(oh.sub(ou)).div(ol.sub(od)).add(ou))}).elseif(e.greaterThanEqual(oc),()=>{t.assign(od.sub(e).mul(op.sub(oh)).div(od.sub(oc)).add(oh))}).elseif(e.greaterThanEqual(om),()=>{t.assign(oc.sub(e).mul(og.sub(op)).div(oc.sub(om)).add(op))}).elseif(e.greaterThanEqual(of),()=>{t.assign(om.sub(e).mul(oN.sub(og)).div(om.sub(of)).add(og))}).else(()=>{t.assign(ez(-2).mul(sb(t2(1.16,e))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),ow=eC(([e,t])=>{let s=e.toVar();s.assign(t2(2,s).sub(1));let r=eq(s,1).toVar();return eO(t.equal(0),()=>{r.assign(r.zyx)}).elseif(t.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).elseif(t.equal(2),()=>{r.x.mulAssign(-1)}).elseif(t.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).elseif(t.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).elseif(t.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),oV=eC(([e,t,s,r,i,o])=>{let a=ez(s),n=eq(t),l=s8(ob(a),ou,o),u=sM(l),d=s_(l),h=eq(o_(e,n,d,r,i,o)).toVar();return eO(u.notEqual(0),()=>{let t=eq(o_(e,n,d.add(1),r,i,o)).toVar();h.assign(s9(h,t,u))}),h}),o_=eC(([e,t,s,r,i,o])=>{let a=ez(s).toVar(),n=eq(t),l=ez(oT(n)).toVar(),u=ez(s$(oy.sub(a),0)).toVar();a.assign(s$(a,oy));let d=ez(sT(a)).toVar(),h=eB(ox(n,l).mul(d.sub(2)).add(1)).toVar();return eO(l.greaterThan(2),()=>{h.y.addAssign(d),l.subAssign(3)}),h.x.addAssign(l.mul(d)),h.x.addAssign(u.mul(t2(3,ov))),h.y.addAssign(t2(4,sT(o).sub(d))),h.x.mulAssign(r),h.y.mulAssign(i),e.uv(h)}),oE=eC(({envMap:e,mipInt:t,outputDirection:s,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:n})=>{let l=sS(r);return o_(e,s.mul(l).add(i.cross(s).mul(sR(r))).add(i.mul(i.dot(s).mul(l.oneMinus()))),t,o,a,n)});eC(({n:e,latitudinal:t,poleAxis:s,outputDirection:r,weights:i,samples:o,dTheta:a,mipInt:n,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:h})=>{let c=eq(on(t,s,s1(s,r))).toVar();eO(sm(c.equals(eq(0))),()=>{c.assign(eq(r.z,0,r.x.negate()))}),c.assign(sA(c));let p=eq().toVar();return p.addAssign(i.element(eF(0)).mul(oE({theta:0,axis:c,outputDirection:r,mipInt:n,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:h}))),ij({start:eF(1),end:e},({i:e})=>{eO(e.greaterThanEqual(o),()=>{iX()});let t=ez(a.mul(ez(e))).toVar();p.addAssign(i.element(e).mul(oE({theta:t.mul(-1),axis:c,outputDirection:r,mipInt:n,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:h}))),p.addAssign(i.element(e).mul(oE({theta:t,axis:c,outputDirection:r,mipInt:n,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:h})))}),e$(p,1)});var y=f("ilwiq");let oA=null;const oM=new WeakMap;class oR extends q{constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null,this._texture=rN(null),this._width=t$(0),this._height=t$(0),this._maxMip=t$(0),this.updateBeforeType=S.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){let t=function(e){let t=Math.log2(e)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:1/e,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem,t=e?e.pmremVersion:-1,s=this._value;t!==s.pmremVersion&&(e=!0===s.isPMREMTexture?s:function(e){let t=oM.get(e);if((void 0!==t?t.pmremVersion:-1)!==e.pmremVersion){if(e.isCubeTexture){if(e.source.data.some(e=>void 0===e))throw Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");t=oA.fromCubemap(e,t)}else{if(void 0===e.image)throw Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");t=oA.fromEquirectangular(e,t)}t.pmremVersion=e.pmremVersion,oM.set(e,t)}return t.texture}(s),this._pmrem=e,this.updateFromTexture(e))}setup(e){null===oA&&(oA=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this));let s=this.value;e.renderer.coordinateSystem===y.WebGLCoordinateSystem&&!0!==s.isPMREMTexture&&!0===s.isRenderTargetTexture&&(t=eq(t.x.negate(),t.yz));let r=this.levelNode;return null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),oV(this._texture,t,r,this._width,this._height,this._maxMip)}}const oS=eR(oR);H("PMREMNode",oR);const oC=new WeakMap;class oL extends i4{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode){let e=oC.get(t.value);void 0===e&&(e=oS(t.value),oC.set(t.value,e)),t=e}let s=e.material.envMap?rM("envMapIntensity","float",e.material):rM("environmentIntensity","float",e.scene),r=tg(t,oI(tA,rK)).mul(s),i=tg(t,oO(rZ)).mul(Math.PI).mul(s),o=tc(r);e.context.radiance.addAssign(o),e.context.iblIrradiance.addAssign(i);let a=e.context.lightingModel.clearcoatRadiance;if(a){let e=tc(tg(t,oI(tS,rQ)).mul(s));a.addAssign(e)}}}const oI=(e,t)=>{let s=null;return{getUV:()=>(null===s&&(s=i_.negate().reflect(t),s=(s=e.mul(e).mix(s,t).normalize()).transformDirection(rG)),s),getTextureLevel:()=>e}},oO=e=>({getUV:()=>e,getTextureLevel:()=>ez(1)});H("EnvironmentNode",oL);var y=f("ilwiq");class oD extends G{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===oD.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=S.NONE;return(this.scope===oD.RESOLUTION||this.scope===oD.VIEWPORT)&&(e=S.FRAME),this.updateType=e,e}update({renderer:s}){this.scope===oD.VIEWPORT?s.getViewport(t):s.getDrawingBufferSize(e)}setup(){let s=this.scope,r=null;if(s===oD.RESOLUTION)r=t$(e||(e=new y.Vector2));else if(s===oD.VIEWPORT)r=t$(t||(t=new y.Vector4));else{let e=(r=oz.div(oF)).x,t=r.y;/bottom/i.test(s)&&(t=t.oneMinus()),/right/i.test(s)&&(e=e.oneMinus()),r=eB(e,t)}return r}generate(e){if(this.scope===oD.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){let s=e.getNodeProperties(oF).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}oD.COORDINATE="coordinate",oD.RESOLUTION="resolution",oD.VIEWPORT="viewport",oD.TOP_LEFT="topLeft",oD.BOTTOM_LEFT="bottomLeft",oD.TOP_RIGHT="topRight",oD.BOTTOM_RIGHT="bottomRight";const oz=eS(oD,oD.COORDINATE),oF=eS(oD,oD.RESOLUTION),oP=eS(oD,oD.VIEWPORT),oU=eS(oD,oD.TOP_LEFT);eS(oD,oD.BOTTOM_LEFT),eS(oD,oD.TOP_RIGHT),eS(oD,oD.BOTTOM_RIGHT),H("ViewportNode",oD);var y=f("ilwiq");const oB=new y.Vector2;class oG extends rf{constructor(e=oU,t=null,s=null){null===s&&((s=new y.FramebufferTexture).minFilter=y.LinearMipmapLinearFilter),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=S.FRAME}updateBefore(e){let t=e.renderer;t.getDrawingBufferSize(oB);let s=this.value;(s.image.width!==oB.width||s.image.height!==oB.height)&&(s.image.width=oB.width,s.image.height=oB.height,s.needsUpdate=!0);let r=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=r}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}var oH=oG;const ok=eR(oG),oq=eR(oG,null,null,{generateMipmaps:!0});er("viewportTexture",ok),er("viewportMipTexture",oq),H("ViewportTextureNode",oG);var y=f("ilwiq");let oW=null;class oj extends oH{constructor(e=oU,t=null){null===oW&&(oW=new y.DepthTexture),super(e,t,oW)}}const oX=eR(oj);er("viewportDepthTexture",oX),H("ViewportDepthTextureNode",oj);class o$ extends G{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){let{scope:t}=this;return t===o$.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){let{scope:e}=this,t=null;return e===o$.DEPTH?t=oY(iV.z,rP,rU):e===o$.DEPTH_TEXTURE?t=oY(oJ(this.valueNode||oX(),rP,rU),rP,rU):e===o$.DEPTH_PIXEL&&null!==this.valueNode&&(t=oK().assign(this.valueNode)),t}}const oY=(e,t,s)=>e.add(t).div(t.sub(s)),oJ=(e,t,s)=>t.mul(s).div(s.sub(t).mul(e).sub(s));o$.DEPTH="depth",o$.DEPTH_TEXTURE="depthTexture",o$.DEPTH_PIXEL="depthPixel";const oK=eR(o$,o$.DEPTH_PIXEL);eS(o$,o$.DEPTH),eR(o$,o$.DEPTH_TEXTURE);const oZ=eS(o$,o$.DEPTH_PIXEL);oZ.assign=e=>oK(e),H("ViewportDepthNode",o$);class oQ extends G{constructor(e=oQ.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);let t=e.clippingContext,{localClipIntersection:s,localClippingCount:r,globalClippingCount:i}=t,o=i+r,a=s?o-r:o;return this.scope===oQ.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(t.planes,o,a):this.setupDefault(t.planes,o,a)}setupAlphaToCoverage(e,t,s){return eC(()=>{let r;let i=rV(e),o=tV("float","distanceToPlane"),a=tV("float","distanceToGradient"),n=tV("float","clipOpacity");if(n.assign(1),ij(s,({i:e})=>{r=i.element(e),o.assign(iV.dot(r.xyz).negate().add(r.w)),a.assign(o.fwidth().div(2)),n.mulAssign(re(a.negate(),a,o)),n.equal(0).discard()}),s<t){let e=tV("float","unionclipOpacity");e.assign(1),ij({start:s,end:t},({i:t})=>{r=i.element(t),o.assign(iV.dot(r.xyz).negate().add(r.w)),a.assign(o.fwidth().div(2)),e.mulAssign(re(a.negate(),a,o).oneMinus())}),n.mulAssign(e.oneMinus())}tE.a.mulAssign(n),tE.a.equal(0).discard()})()}setupDefault(e,t,s){return eC(()=>{let r;let i=rV(e);if(ij(s,({i:e})=>{r=i.element(e),iV.dot(r.xyz).greaterThan(r.w).discard()}),s<t){let e=tV("bool","clipped");e.assign(!0),ij({start:s,end:t},({i:t})=>{r=i.element(t),e.assign(iV.dot(r.xyz).greaterThan(r.w).and(e))}),e.discard()}})()}}oQ.ALPHA_TO_COVERAGE="alphaToCoverage",oQ.DEFAULT="default";const o0=()=>eE(new oQ),o1=()=>eE(new oQ(oQ.ALPHA_TO_COVERAGE));class o2 extends G{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}const o3=ez(eS(o2)).mul(2).sub(1);H("FrontFacingNode",o2);const o4=new Map;class o5 extends y.ShaderMaterial{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpaced=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+L(this)}build(e){this.setup(e)}setup(e){let t;e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let s=this.setupClipping(e);if(null===this.fragmentNode){!0===this.depthWrite&&this.setupDepth(e),!0===this.normals&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);let r=this.setupLighting(e);null!==s&&e.stack.add(s);let i=e$(r,tE.a).max(0);t=this.setupOutput(e,i),tP.assign(t),null!==this.outputNode&&(t=this.outputNode)}else t=this.setupOutput(e,this.fragmentNode);e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupClipping(e){let{globalClippingCount:t,localClippingCount:s}=e.clippingContext,r=null;return(t||s)&&(this.alphaToCoverage?r=o1():e.stack.add(o0())),r}setupDepth(e){let{renderer:t}=e,s=this.depthNode;null===s&&!0===t.logarithmicDepthBuffer&&(s=iA().w.add(1).log2().mul(rB).mul(.5)),null!==s&&oZ.assign(s).append()}setupPosition(e){let{object:t}=e,s=t.geometry;e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&iZ(t).append(),!0===t.isSkinnedMesh&&iq(t).append(),t.isBatchedMesh&&iH(t).append(),t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&!0===e.isAvailable("instance")&&iO(t).append(),null!==this.positionNode&&ix.assign(this.positionNode);let r=iA();return e.context.vertex=e.removeStack(),e.context.mvp=r,r}setupDiffuseColor({object:e,geometry:t}){let s=this.colorNode?e$(this.colorNode):r3;!0===this.vertexColors&&t.hasAttribute("color")&&(s=e$(s.xyz.mul(ta("color","vec3")),s.a)),e.instanceColor&&(s=t_("vec3","vInstanceColor").mul(s)),tE.assign(s);let r=this.opacityNode?ez(this.opacityNode):r6;if(tE.a.assign(tE.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){let e=null!==this.alphaTestNode?ez(this.alphaTestNode):r2;tE.a.lessThanEqual(e).discard()}}setupVariants(){}setupNormal(){if(!0===this.flatShading){let e=iV.dFdx().cross(iV.dFdy()).normalize();rK.assign(e.mul(o3))}else{let e=this.normalNode?eq(this.normalNode):it;rK.assign(e.mul(o3))}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?i2(this.envMap):rN(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){let t=this.getEnvNode(e),s=[];t&&s.push(new oL(t)),e.material.aoMap&&s.push(new os(rN(e.material.aoMap)));let r=this.lightsNode||e.lightsNode;return s.length>0&&(r=oe([...r.lightNodes,...s])),r}setupLightingModel(){}setupLighting(e){let{material:t}=e,{backdropNode:s,backdropAlphaNode:r,emissiveNode:i}=this,o=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null,a=tE.rgb;return o&&!1!==o.hasLight?a=oi(o,this.setupLightingModel(e),s,r):null!==s&&(a=eq(null!==r?s9(a,s,r):s)),(i&&!0===i.isNode||t.emissive&&!0===t.emissive.isColor)&&(a=a.add(eq(i||r5))),a}setupOutput(e,t){let s=e.renderer;if(!0===this.fog){let s=e.fogNode;s&&(t=e$(s.mix(t.rgb,s.colorNode),t.a))}let r=e.toneMappingNode;if(!0===this.toneMapped&&r&&(t=e$(r.context({color:t.rgb}),t.a)),!0===this.colorSpaced){let e=s.currentColorSpace;e!==y.LinearSRGBColorSpace&&e!==y.NoColorSpace&&(t=t.linearToColorSpace(e))}return t}setDefaultValues(e){for(let t in e){let s=e[t];void 0===this[t]&&(this[t]=s,s&&s.clone&&(this[t]=s.clone()))}Object.assign(this.defines,e.defines);let t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(let e in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,e)&&void 0!==t[e].get&&Object.defineProperty(this.constructor.prototype,e,t[e])}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{},nodes:{}});let s=(0,y.Material).prototype.toJSON.call(this,e),r=I(this);for(let{property:t,childNode:i}of(s.inputNodes={},r))s.inputNodes[t]=i.toJSON(e).uuid;function i(e){let t=[];for(let s in e){let r=e[s];delete r.metadata,t.push(r)}return t}if(t){let t=i(e.textures),r=i(e.images),o=i(e.nodes);t.length>0&&(s.textures=t),r.length>0&&(s.images=r),o.length>0&&(s.nodes=o)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(!0===e.isNodeMaterial)return e;let t=o8(e.type.replace("Material","NodeMaterial"));if(void 0===t)throw Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(let s in e)t[s]=e[s];return t}}var o6=o5;function o9(e,t){if("function"!=typeof t||!e)throw Error(`Node material ${e} is not a class`);if(o4.has(e)){console.warn(`Redefinition of node material ${e}`);return}o4.set(e,t),t.type=e}function o8(e){let t=o4.get(e);if(void 0!==t)return new t}o9("NodeMaterial",o5);var y=(f("ilwiq"),f("ilwiq"));class o7 extends G{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){let s=new e_(t);return this._currentCond=on(e,s),this.add(this._currentCond)}elseif(e,t){let s=on(e,new e_(t));return this._currentCond.elseNode=s,this._currentCond=s,this}else(e){return this._currentCond.elseNode=new e_(e),this}build(e,...t){let s=eI();for(let t of(eL(this),this.nodes))t.build(e,"void");return eL(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}eR(o7),H("StackNode",o7);var y=f("ilwiq");class ae extends q{constructor(e=iw){super("vec2"),this.dirNode=e}setup(){let e=this.dirNode;return eB(e.z.atan2(e.x).mul(1/(2*Math.PI)).add(.5),e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5))}}eR(ae),H("EquirectUVNode",ae);var y=f("ilwiq");const at=ow(tJ(),ta("faceIndex")).normalize();eq(at.x,at.y.negate(),at.z),new class{constructor(){this.weakMap=new WeakMap}get(e){if(!Array.isArray(e))return super.get(e);{let t=this.weakMap;for(let s=0;s<e.length;s++)if(void 0===(t=t.get(e[s])))return;return t.get(e[e.length-1])}}set(e,t){if(!Array.isArray(e))return super.set(e,t);{let s=this.weakMap;for(let t=0;t<e.length;t++){let r=e[t];!1===s.has(r)&&s.set(r,new WeakMap),s=s.get(r)}return s.set(e[e.length-1],t)}}delete(e){if(!Array.isArray(e))return super.delete(e);{let t=this.weakMap;for(let s=0;s<e.length;s++)if(void 0===(t=t.get(e[s])))return!1;return t.delete(e[e.length-1])}}dispose(){this.weakMap.clear()}},Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array;class as extends G{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}H("StructTypeNode",as);class ar extends G{constructor(...e){super(),this.isOutputStructNode=!0,this.members=e}setup(e){super.setup(e);let t=this.members,s=[];for(let r=0;r<t.length;r++)s.push(t[r].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new as(s)).name}generate(e,t){let s=e.getVarFromNode(this);s.isOutputStructVar=!0;let r=e.getPropertyName(s),i=this.members,o=""!==r?r+".":"";for(let s=0;s<i.length;s++){let r=i[s].build(e,t);e.addLineFlowCode(`${o}m${s} = ${r}`)}return r}}eR(ar),H("OutputStructNode",ar);class ai extends G{constructor(e){super(),this.seedNode=e}setup(){let e=this.seedNode.uint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).float().mul(1/4294967296)}}er("hash",eR(ai)),H("HashNode",ai);const ao=(e,t)=>s2(t2(4,e.mul(t1(1,e))),t);er("parabola",ao),er("gain",(e,t)=>e.lessThan(.5)?ao(e.mul(2),t).div(2):t1(1,ao(t2(t1(1,e),2),t).div(2))),er("pcurve",(e,t,s)=>s2(t3(s2(e,t),t0(s2(e,t),s2(t1(1,e),s))),1/t)),er("sinc",(e,t)=>sR(sp.mul(t.mul(e).sub(1))).div(sp.mul(t.mul(e).sub(1))));const aa=eC(([e])=>e.fract().sub(.5).abs()),an=eC(([e])=>eq(aa(e.z.add(aa(e.y.mul(1)))),aa(e.z.add(aa(e.x.mul(1)))),aa(e.y.add(aa(e.x.mul(1)))))),al=eC(([e,t,s])=>{let r=eq(e).toVar(),i=ez(1.4).toVar(),o=ez(0).toVar(),a=eq(r).toVar();return ij({start:ez(0),end:ez(3),type:"float",condition:"<="},()=>{let e=eq(an(a.mul(2))).toVar();r.addAssign(e.add(s.mul(ez(.1).mul(t)))),a.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);let n=ez(aa(r.z.add(aa(r.x.add(aa(r.y)))))).toVar();o.addAssign(n.div(i)),a.addAssign(.14)}),o});aa.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),an.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),al.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});class au extends oa{constructor(e){super(e,s=s||rc("discard"))}}const ad=eR(au);er("discard",e=>ad(e).append()),H("DiscardNode",au);class ah extends G{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){let t=this.parametersNodes,s=this._candidateFnCall;if(null===s){let r=null,i=-1;for(let s of this.functionNodes){let o=s.shaderNode.layout;if(null===o)throw Error("FunctionOverloadingNode: FunctionNode must be a layout.");let a=o.inputs;if(t.length===a.length){let o=0;for(let s=0;s<t.length;s++){let r=t[s],i=a[s];r.getNodeType(e)===i.type?o++:o=0}o>i&&(r=s,i=o)}}this._candidateFnCall=s=r(...t)}return s}}const ac=eR(ah),ap=e=>(...t)=>ac(e,...t);H("FunctionOverloadingNode",ah);class am extends q{constructor(){super("vec2")}setup(){let e=eq(i_.z,0,i_.x.negate()).normalize(),t=i_.cross(e);return eB(e.dot(rK),t.dot(rK)).mul(.495).add(.5)}}eS(am),H("MatcapUVNode",am);class ag extends tX{constructor(e=ag.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=S.FRAME}update(e){let t=this.scope,s=this.scale;t===ag.LOCAL?this.value+=e.deltaTime*s:t===ag.DELTA?this.value=e.deltaTime*s:t===ag.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}ag.LOCAL="local",ag.GLOBAL="global",ag.DELTA="delta",ag.FRAME="frame";const af=(e,t=0)=>eE(new ag(ag.LOCAL,e,t));eS(ag,ag.FRAME).uint(),H("TimerNode",ag);class aN extends G{constructor(e=aN.SINE,t=af()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){let e=this.method,t=eE(this.timeNode),s=null;return e===aN.SINE?s=t.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5):e===aN.SQUARE?s=t.fract().round():e===aN.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===aN.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}aN.SINE="sine",aN.SQUARE="square",aN.TRIANGLE="triangle",aN.SAWTOOTH="sawtooth",eR(aN,aN.SINE),eR(aN,aN.SQUARE),eR(aN,aN.TRIANGLE),eR(aN,aN.SAWTOOTH),H("OscNode",aN);class ay extends q{constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){let{scope:e,node:t}=this,s=null;return e===ay.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===ay.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}ay.DIRECTION_TO_COLOR="directionToColor",ay.COLOR_TO_DIRECTION="colorToDirection";const av=eR(ay,ay.DIRECTION_TO_COLOR),aT=eR(ay,ay.COLOR_TO_DIRECTION);er("directionToColor",av),er("colorToDirection",aT),H("PackingNode",ay);class ax extends G{constructor(e,t,s,r=ez(0),i=ez(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){let{node:e,inLowNode:t,inHighNode:s,outLowNode:r,outHighNode:i,doClamp:o}=this,a=e.sub(t).div(s.sub(t));return!0===o&&(a=a.clamp()),a.mul(i.sub(r)).add(r)}}const ab=eR(ax,null,null,{doClamp:!1}),aw=eR(ax);er("remap",ab),er("remapClamp",aw),H("RemapNode",ax);class aV extends q{constructor(e,t,s=eB(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){let{uvNode:e,rotationNode:t,centerNode:s}=this;return e.sub(s).rotate(t).add(s)}}er("rotateUV",eR(aV)),H("RotateUVNode",aV);class a_ extends q{constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){let{rotationNode:t,positionNode:s}=this;if("vec2"===this.getNodeType(e)){let e=t.cos(),r=t.sin();return eZ(e,r,r.negate(),e).mul(s)}{let e=e6(e$(1,0,0,0),e$(0,sS(t.x),sR(t.x).negate(),0),e$(0,sR(t.x),sS(t.x),0),e$(0,0,0,1)),r=e6(e$(sS(t.y),0,sR(t.y),0),e$(0,1,0,0),e$(sR(t.y).negate(),0,sS(t.y),0),e$(0,0,0,1)),i=e6(e$(sS(t.z),sR(t.z).negate(),0,0),e$(sR(t.z),sS(t.z),0,0),e$(0,0,1,0),e$(0,0,0,1));return e.mul(r).mul(i).mul(e$(s,1)).xyz}}}er("rotate",eR(a_)),H("RotateNode",a_);class aE extends G{constructor(e,t=tJ(),s=ez(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){let{frameNode:e,uvNode:t,countNode:s}=this,{width:r,height:i}=s,o=e.mod(r.mul(i)).floor(),a=o.mod(r),n=i.sub(o.add(1).div(r).ceil()),l=s.reciprocal(),u=eB(a,n);return t.add(u).mul(l)}}eR(aE),H("SpriteSheetUVNode",aE);class aA extends j{constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return!1!==e.isAvailable("storageBuffer")||this.node.instanceIndex||!0!==this.node.bufferObject||e.setupPBO(this.node),super.setup(e)}generate(e,t){let s;let r=e.context.assign;if(!1===e.isAvailable("storageBuffer")){let{node:t}=this;s=t.instanceIndex||!0!==this.node.bufferObject||!0===r?t.build(e):e.generatePBO(this)}else s=super.generate(e);if(!0!==r){let r=this.getNodeType(e);s=e.format(s,r,t)}return s}}const aM=eR(aA);er("storageElement",aM),H("StorageArrayElementNode",aA);class aR extends G{constructor(e,t=null,s=null,r=ez(1),i=ix,o=r$){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=r,this.positionNode=i,this.normalNode=o}setup(){let{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:r,positionNode:i,normalNode:o}=this,a=o.abs().normalize();a=a.div(a.dot(eq(1)));let n=i.yz.mul(r),l=i.zx.mul(r),u=i.xy.mul(r),d=e.value,h=null!==t?t.value:d,c=null!==s?s.value:d;return t0(rN(d,n).mul(a.x),rN(h,l).mul(a.y),rN(c,u).mul(a.z))}}const aS=eR(aR);er("triplanarTexture",(...e)=>aS(...e)),H("TriplanarTexturesNode",aR);var y=f("ilwiq");new y.Plane,new y.Vector3,new y.Vector3,new y.Vector3,new y.Matrix4,new y.Vector3(0,0,-1),new y.Vector4,new y.Vector3,new y.Vector3,new y.Vector4,new y.Vector2,new y.RenderTarget,eB(oU.x.oneMinus(),oU.y);class aC extends G{constructor(e=aC.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){let t;let s=this.scope;return s===aC.GEOMETRY?t=rX.cross(iz):s===aC.LOCAL?t=r$.cross(iF):s===aC.VIEW?t=rY.cross(iP):s===aC.WORLD&&(t=rJ.cross(iU)),sA(tr(t.mul(iz.w).xyz)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}aC.GEOMETRY="geometry",aC.LOCAL="local",aC.VIEW="view",aC.WORLD="world",eS(aC,aC.GEOMETRY),eS(aC,aC.LOCAL);const aL=eS(aC,aC.VIEW);eS(aC,aC.WORLD);const aI=sA(rK.cross(iB).mul(iz.w));sA(aI.transformDirection(rG)),H("BitangentNode",aC);const aO=e2(iP,aL,rY);i_.mul(aO);var y=f("ilwiq");H("VertexColorNode",class extends to{constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){let e=this.index;return"color"+(e>0?e:"")}generate(e){let t=this.getAttributeName(e);return!0===e.hasGeometryAttribute(t)?super.generate(e):e.generateConst(this.nodeType,new y.Vector4(1,1,1,1))}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}});class aD extends rA{constructor(e,t,s=null){super(e,t,s),this.renderer=s}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}H("RendererReferenceNode",aD);const az=1/6,aF=e=>t2(az,t2(e,t2(e,e.negate().add(3)).sub(3)).add(1)),aP=e=>t2(az,t2(e,t2(e,t2(3,e).sub(6))).add(4)),aU=e=>t2(az,t2(e,t2(e,t2(-3,e).add(3)).add(3)).add(1)),aB=e=>t2(az,s2(e,3)),aG=e=>aF(e).add(aP(e)),aH=e=>aU(e).add(aB(e)),ak=e=>t0(-1,aP(e).div(aF(e).add(aP(e)))),aq=e=>t0(1,aB(e).div(aU(e).add(aB(e)))),aW=(e,t,s)=>{let r=t2(e.uvNode,t.zw).add(.5),i=s_(r),o=sM(r),a=aG(o.x),n=aH(o.x),l=ak(o.x),u=aq(o.x),d=ak(o.y),h=aq(o.y),c=eB(i.x.add(l),i.y.add(d)).sub(.5).mul(t.xy),p=eB(i.x.add(u),i.y.add(d)).sub(.5).mul(t.xy),m=eB(i.x.add(l),i.y.add(h)).sub(.5).mul(t.xy),g=eB(i.x.add(u),i.y.add(h)).sub(.5).mul(t.xy),f=aG(o.y).mul(t0(a.mul(e.uv(c).level(s)),n.mul(e.uv(p).level(s)))),N=aH(o.y).mul(t0(a.mul(e.uv(m).level(s)),n.mul(e.uv(g).level(s))));return f.add(N)},aj=(e,t)=>{let s=eB(e.size(eF(t))),r=eB(e.size(eF(t.add(1)))),i=t3(1,s),o=t3(1,r),a=aW(e,e$(i,s),s_(t)),n=aW(e,e$(o,r),sE(t));return sM(t).mix(a,n)};class aX extends q{constructor(e,t=ez(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return aj(this.textureNode,this.blurNode)}}er("bicubic",eR(aX)),H("TextureBicubicNode",aX);class a$ extends G{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}eS(a$),H("PointUVNode",a$);class aY extends G{constructor(e=aY.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){let t;let s=this.scope,r=null!==this.scene?this.scene:e.scene;return s===aY.BACKGROUND_BLURRINESS?t=rM("backgroundBlurriness","float",r):s===aY.BACKGROUND_INTENSITY?t=rM("backgroundIntensity","float",r):console.error("THREE.SceneNode: Unknown scope:",s),t}}aY.BACKGROUND_BLURRINESS="backgroundBlurriness",aY.BACKGROUND_INTENSITY="backgroundIntensity",eS(aY,aY.BACKGROUND_BLURRINESS),eS(aY,aY.BACKGROUND_INTENSITY),H("SceneNode",aY),H("StorageBufferNode",class extends rT{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0,this.bufferObject=!1,this._attribute=null,this._varying=null}getInputType(){return"storageBuffer"}element(e){return aM(this,e)}setBufferObject(e){return this.bufferObject=e,this}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);let t=this.getNodeType(e);null===this._attribute&&(this._attribute=iR(this.value),this._varying=tr(this._attribute));let s=this._varying.build(e,t);return e.registerTransform(s,this._attribute),s}});class aJ extends rf{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStoreTextureNode=!0}getInputType(){return"storageTexture"}setup(e){super.setup(e),e.getNodeProperties(this).storeNode=this.storeNode}generate(e,t){return null!==this.storeNode?this.generateStore(e):super.generate(e,t)}generateStore(e){let{uvNode:t,storeNode:s}=e.getNodeProperties(this),r=super.generate(e,"property"),i=t.build(e,"uvec2"),o=s.build(e,"vec4"),a=e.generateTextureStore(e,r,i,o);e.addLineFlowCode(a)}}eR(aJ),H("TextureStoreNode",aJ),H("UserDataNode",class extends rA{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=null!==this.userData?this.userData:e.object.userData,super.update(e)}});const aK=eC(({base:e,blend:t})=>{let s=s=>t[s].lessThan(sc).cond(t[s],e[s].oneMinus().div(t[s]).oneMinus().max(0));return eq(s("x"),s("y"),s("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),aZ=eC(({base:e,blend:t})=>{let s=s=>t[s].equal(1).cond(t[s],e[s].div(t[s].oneMinus()).max(0));return eq(s("x"),s("y"),s("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),aQ=eC(({base:e,blend:t})=>{let s=s=>e[s].oneMinus().mul(t[s].oneMinus()).oneMinus();return eq(s("x"),s("y"),s("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),a0=eC(({base:e,blend:t})=>{let s=s=>e[s].lessThan(.5).cond(e[s].mul(t[s],2),e[s].oneMinus().mul(t[s].oneMinus()).oneMinus());return eq(s("x"),s("y"),s("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class a1 extends q{constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){let{blendMode:e,baseNode:t,blendNode:s}=this,r={base:t,blend:s},i=null;return e===a1.BURN?i=aK(r):e===a1.DODGE?i=aZ(r):e===a1.SCREEN?i=aQ(r):e===a1.OVERLAY&&(i=a0(r)),i}}a1.BURN="burn",a1.DODGE="dodge",a1.SCREEN="screen",a1.OVERLAY="overlay";const a2=eR(a1,a1.BURN),a3=eR(a1,a1.DODGE),a4=eR(a1,a1.OVERLAY),a5=eR(a1,a1.SCREEN);er("burn",a2),er("dodge",a3),er("overlay",a4),er("screen",a5),H("BlendModeNode",a1);const a6=eC(({textureNode:e,bumpScale:t})=>{let s=e;if(!0!==s.isTextureNode&&s.traverse(e=>{!0===e.isTextureNode&&(s=e)}),!0!==s.isTextureNode)throw Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");let r=ez(e),i=s.uvNode||tJ(),o=t=>e.cache().context({getUV:()=>t,forceUVContext:!0});return eB(ez(o(i.add(i.dFdx()))).sub(r),ez(o(i.add(i.dFdy()))).sub(r)).mul(t)}),a9=eC(e=>{let{surf_pos:t,surf_norm:s,dHdxy:r}=e,i=t.dFdx().normalize(),o=t.dFdy().normalize().cross(s),a=s.cross(i),n=i.dot(o).mul(o3),l=n.sign().mul(r.x.mul(o).add(r.y.mul(a)));return n.abs().mul(s).sub(l).normalize()});class a8 extends q{constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){let e=null!==this.scaleNode?this.scaleNode:1;return a9({surf_pos:iV,surf_norm:rY,dHdxy:a6({textureNode:this.textureNode,bumpScale:e})})}}er("bumpMap",eR(a8)),H("BumpMapNode",a8);const a7=eC(({color:e,adjustment:t})=>t.mix(nn(e.rgb),e.rgb)),ne=eC(({color:e,adjustment:t})=>{let s=t0(e.r,e.g,e.b).div(3),r=e.r.max(e.g.max(e.b)),i=r.sub(s).mul(t).mul(-3);return s9(e.rgb,r,i)}),nt=eC(({color:e,adjustment:t})=>{let s=eq(.57735,.57735,.57735),r=t.cos();return eq(e.rgb.mul(r).add(s.cross(e.rgb).mul(t.sin()).add(s.mul(s0(s,e.rgb).mul(r.oneMinus())))))});class ns extends q{constructor(e,t,s=ez(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){let{method:e,colorNode:t,adjustmentNode:s}=this,r={color:t,adjustment:s},i=null;return e===ns.SATURATION?i=a7(r):e===ns.VIBRANCE?i=ne(r):e===ns.HUE?i=nt(r):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}ns.SATURATION="saturation",ns.VIBRANCE="vibrance",ns.HUE="hue";const nr=eR(ns,ns.SATURATION),ni=eR(ns,ns.VIBRANCE),no=eR(ns,ns.HUE),na=eq(.2125,.7154,.0721),nn=(e,t=na)=>s0(e,t),nl=(e,t)=>s9(eq(0),e,nn(e).sub(t).max(0));er("saturation",nr),er("vibrance",ni),er("hue",no),er("threshold",nl),H("ColorAdjustmentNode",ns);var y=f("ilwiq");const nu=eC(e=>{let{eye_pos:t,surf_norm:s,mapN:r,uv:i}=e,o=t.dFdx(),a=t.dFdy(),n=i.dFdx(),l=i.dFdy(),u=a.cross(s),d=s.cross(o),h=u.mul(n.x).add(d.mul(l.x)),c=u.mul(n.y).add(d.mul(l.y)),p=h.dot(h).max(c.dot(c)),m=o3.mul(p.inverseSqrt());return t0(h.mul(r.x,m),c.mul(r.y,m),s.mul(r.z)).normalize()});class nd extends q{constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=y.TangentSpaceNormalMap}setup(e){let{normalMapType:t,scaleNode:s}=this,r=this.node.mul(2).sub(1);null!==s&&(r=eq(r.xy.mul(s),r.z));let i=null;return t===y.ObjectSpaceNormalMap?i=rq.mul(r).normalize():t===y.TangentSpaceNormalMap&&(i=!0===e.hasGeometryAttribute("tangent")?aO.mul(r).normalize():nu({eye_pos:iV,surf_norm:rY,mapN:r,uv:tJ()})),i}}er("normalMap",eR(nd)),H("NormalMapNode",nd);class nh extends q{constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){let{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}er("posterize",eR(nh)),H("PosterizeNode",nh);var y=f("ilwiq");const nc=eC(({color:e,exposure:t})=>e.mul(t).clamp()),np=eC(({color:e,exposure:t})=>(e=e.mul(t)).div(e.add(1)).clamp()),nm=eC(({color:e,exposure:t})=>{let s=(e=(e=e.mul(t)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),r=e.mul(e.mul(6.2).add(1.7)).add(.06);return s.div(r).pow(2.2)}),ng=eC(({color:e})=>{let t=e.mul(e.add(.0245786)).sub(90537e-9),s=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(s)}),nf=eC(({color:e,exposure:t})=>{let s=e2(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=e2(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=ng({color:e=s.mul(e)}),(e=r.mul(e)).clamp()}),nN=e2(eq(1.6605,-.1246,-.0182),eq(-.5876,1.1329,-.1006),eq(-.0728,-.0083,1.1187)),ny=e2(eq(.6274,.0691,.0164),eq(.3293,.9195,.088),eq(.0433,.0113,.8956)),nv=eC(([e])=>{let t=eq(e).toVar(),s=eq(t.mul(t)).toVar(),r=eq(s.mul(s)).toVar();return ez(15.5).mul(r.mul(s)).sub(t2(40.14,r.mul(t))).add(t2(31.96,r).sub(t2(6.868,s.mul(t))).add(t2(.4298,s).add(t2(.1191,t).sub(.00232))))}),nT=eC(({color:e,exposure:t})=>{let s=eq(e).toVar(),r=e2(eq(.856627153315983,.137318972929847,.11189821299995),eq(.0951212405381588,.761241990602591,.0767994186031903),eq(.0482516061458583,.101439036467562,.811302368396859)),i=e2(eq(1.1271005818144368,-.1413297634984383,-.14132976349843826),eq(-.11060664309660323,1.157823702216272,-.11060664309660294),eq(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=ez(-12.47393),a=ez(4.026069);return s.mulAssign(t),s.assign(ny.mul(s)),s.assign(r.mul(s)),s.assign(s$(s,1e-10)),s.assign(sb(s)),s.assign(s.sub(o).div(a.sub(o))),s.assign(s8(s,0,1)),s.assign(nv(s)),s.assign(i.mul(s)),s.assign(s2(s$(eq(0),s),eq(2.2))),s.assign(nN.mul(s)),s.assign(s8(s,0,1)),s}),nx={[y.LinearToneMapping]:nc,[y.ReinhardToneMapping]:np,[y.CineonToneMapping]:nm,[y.ACESFilmicToneMapping]:nf,[y.AgXToneMapping]:nT};class nb extends q{constructor(e=y.NoToneMapping,t=nV,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return"{toneMapping:"+this.toneMapping+",nodes:"+e+"}"}setup(e){let t=this.colorNode||e.context.color,s=this.toneMapping;if(s===y.NoToneMapping)return t;let r={exposure:this.exposureNode,color:t},i=nx[s],o=null;return i?o=i(r):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),o=t),o}}const nw=(e,t,s)=>eE(new nb(e,eE(t),eE(s))),nV=eE(new aD("toneMappingExposure","float",void 0));er("toneMapping",(e,t,s)=>nw(t,s,e)),H("ToneMappingNode",nb);var y=f("ilwiq");let n_=null;class nE extends oH{constructor(e=oU,t=null){null===n_&&(n_=new y.FramebufferTexture),super(e,t,n_)}updateReference(){return this}}er("viewportSharedTexture",eR(nE)),H("ViewportSharedTextureNode",nE);var y=f("ilwiq");class nA extends rf{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class nM extends q{constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;let r=new y.DepthTexture;r.isRenderTargetTexture=!0,r.name="PostProcessingDepth";let i=new y.RenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:y.HalfFloatType});i.texture.name="PostProcessing",i.depthTexture=r,this.renderTarget=i,this.updateBeforeType=S.FRAME,this._textureNode=eE(new nA(this,i.texture)),this._depthTextureNode=eE(new nA(this,r)),this._depthNode=null,this._viewZNode=null,this._cameraNear=t$(0),this._cameraFar=t$(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getViewZNode(){if(null===this._viewZNode){let e=this._cameraNear,t=this._cameraFar;this._viewZNode=oJ(this._depthTextureNode,e,t)}return this._viewZNode}getDepthNode(){if(null===this._depthNode){let e=this._cameraNear,t=this._cameraFar;this._depthNode=oY(this.getViewZNode(),e,t)}return this._depthNode}setup(){return this.scope===nM.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){let{renderer:t}=e,{scene:s,camera:r}=this;this._pixelRatio=t.getPixelRatio();let i=t.getSize(new y.Vector2);this.setSize(i.width,i.height);let o=t.toneMapping,a=t.toneMappingNode,n=t.getRenderTarget();this._cameraNear.value=r.near,this._cameraFar.value=r.far,t.toneMapping=y.NoToneMapping,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,r),t.toneMapping=o,t.toneMappingNode=a,t.setRenderTarget(n)}setSize(e,t){this._width=e,this._height=t;let s=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(s,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}nM.COLOR="color",nM.DEPTH="depth";const nR=(e,t)=>eE(new nA(e,t));H("PassNode",nM);var y=(f("ilwiq"),f("ilwiq"));const nS=new y.OrthographicCamera(-1,1,1,-1,0,1);class nC extends y.BufferGeometry{constructor(e=!1){super(),this.setAttribute("position",new y.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new y.Float32BufferAttribute(!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0],2))}}const nL=new nC;class nI extends y.Mesh{constructor(e=null){super(nL,e),this.camera=nS}renderAsync(e){return e.renderAsync(this,nS)}render(e){e.render(this,nS)}}const nO=new nI,nD=new nI;class nz extends q{constructor(e,t=2){super("vec4"),this.textureNode=e,this.sigma=t,this.directionNode=eB(1),this._invSize=t$(new y.Vector2),this._passDirection=t$(new y.Vector2),this._horizontalRT=new y.RenderTarget,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new y.RenderTarget,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=nR(this,this._verticalRT.texture),this.updateBeforeType=S.RENDER,this.resolution=new y.Vector2(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){let{renderer:t}=e,s=this.textureNode,r=s.value,i=t.getRenderTarget(),o=s.value;nO.material=this._material,nD.material=this._material,this.setSize(r.image.width,r.image.height);let a=r.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),nO.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),nD.render(t),t.setRenderTarget(i),s.value=o}getTextureNode(){return this._textureNode}setup(e){let t=this.textureNode;if(!0!==t.isTextureNode)return console.error("GaussianBlurNode requires a TextureNode."),e$();let s=t.uvNode||tJ(),r=e=>t.cache().context({getUV:()=>e,forceUVContext:!0}),i=eC(()=>{let e=3+2*this.sigma,t=this._getCoefficients(e),i=this._invSize,o=eB(this.directionNode).mul(this._passDirection),a=ez(t[0]).toVar(),n=e$(r(s).mul(a)).toVar();for(let l=1;l<e;l++){let e=ez(l),u=ez(t[l]),d=eB(o.mul(i.mul(e))).toVar(),h=e$(r(s.add(d))),c=e$(r(s.sub(d)));n.addAssign(h.add(c).mul(u)),a.addAssign(t2(2,u))}return n.div(a)});return(this._material||(this._material=e.createNodeMaterial())).fragmentNode=i(),e.getNodeProperties(this).textureNode=t,this._textureNode}_getCoefficients(e){let t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}er("gaussianBlur",(e,t)=>eE(new nz(eE(e),t)));var y=f("ilwiq");const nF=new nI;class nP extends q{constructor(e,t=.96){super(e),this.textureNode=e,this.textureNodeOld=rN(),this.damp=t$(t),this._compRT=new y.RenderTarget,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new y.RenderTarget,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=nR(this,this._compRT.texture),this.updateBeforeType=S.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._compRT.setSize(e,t),this._oldRT.setSize(e,t)}updateBefore(e){let{renderer:t}=e,s=this.textureNode,r=s.value,i=r.type;this._compRT.texture.type=i,this._oldRT.texture.type=i;let o=t.getRenderTarget(),a=s.value;this.textureNodeOld.value=this._oldRT.texture,t.setRenderTarget(this._compRT),nF.render(t);let n=this._oldRT;this._oldRT=this._compRT,this._compRT=n,this.setSize(r.image.width,r.image.height),t.setRenderTarget(o),s.value=a}setup(e){let t=this.textureNode,s=this.textureNodeOld;if(!0!==t.isTextureNode)return console.error("AfterImageNode requires a TextureNode."),e$();let r=t.uvNode||tJ();s.uvNode=r;let i=e=>t.cache().context({getUV:()=>e,forceUVContext:!0}),o=eC(([e,t])=>{let s=ez(t).toVar();return s$(sz(e$(e).toVar().sub(s)),0)}),a=eC(()=>{let e=e$(s),t=e$(i(r));return e.mulAssign(this.damp.mul(o(e,.1))),s$(t,e)}),n=this._materialComposed||(this._materialComposed=e.createNodeMaterial());return n.fragmentNode=a(),nF.material=n,e.getNodeProperties(this).textureNode=t,this._textureNode}}er("afterImage",(e,t)=>eE(new nP(eE(e),t)));var y=f("ilwiq");const nU=new nI;class nB extends q{constructor(e,t,s,r){super("vec4"),this.textureNode=e,this.tresholdNode=t,this.scaleNode=s,this.colorNode=eq(.1,0,1),this.samples=r,this.resolution=new y.Vector2(1,1),this._renderTarget=new y.RenderTarget,this._renderTarget.texture.name="anamorphic",this._invSize=t$(new y.Vector2),this._textureNode=nR(this,this._renderTarget.texture),this.updateBeforeType=S.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._invSize.value.set(1/e,1/t),e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._renderTarget.setSize(e,t)}updateBefore(e){let{renderer:t}=e,s=this.textureNode,r=s.value;this._renderTarget.texture.type=r.type;let i=t.getRenderTarget(),o=s.value;nU.material=this._material,this.setSize(r.image.width,r.image.height),t.setRenderTarget(this._renderTarget),nU.render(t),t.setRenderTarget(i),s.value=o}setup(e){let t=this.textureNode;if(!0!==t.isTextureNode)return console.error("AnamorphNode requires a TextureNode."),e$();let s=t.uvNode||tJ(),r=e=>t.cache().context({getUV:()=>e,forceUVContext:!0}),i=eC(()=>{let e=Math.floor(this.samples/2),t=eq(0).toVar();return ij({start:-e,end:e},({i:i})=>{let o=ez(i).abs().div(e).oneMinus(),a=nl(r(eB(s.x.add(this._invSize.x.mul(i).mul(this.scaleNode)),s.y)),this.tresholdNode).mul(o);t.addAssign(a)}),t.mul(this.colorNode)});return(this._material||(this._material=e.createNodeMaterial())).fragmentNode=i(),e.getNodeProperties(this).textureNode=t,this._textureNode}}er("anamorphic",(e,t=.9,s=3,r=32)=>eE(new nB(eE(e),eE(t),eE(s),r)));class nG extends q{constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){let t=[],s=this.functionNode,r=s.getInputs(e),i=this.parameters;if(Array.isArray(i))for(let s=0;s<i.length;s++){let o=r[s],a=i[s];t.push(a.build(e,o.type))}else for(let s of r){let r=i[s.name];if(void 0!==r)t.push(r.build(e,s.type));else throw Error(`FunctionCallNode: Input '${s.name}' not found in FunctionNode.`)}let o=s.build(e,"property");return`${o}( ${t.join(", ")} )`}}er("call",(e,...t)=>(t=t.length>1||t[0]&&!0===t[0].isNode?eM(t):eA(t[0]),eE(new nG(eE(e),t)))),H("FunctionCallNode",nG);var y=f("ilwiq");class nH extends G{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new y.EventDispatcher,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(e){this._value!==e&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){let e=this.value;if(e&&null===this._cache&&"URL"===this.inputType&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&null!==e.value&&void 0!==e.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof e.value||"Number"===this.inputType&&"number"==typeof e.value||"Vector2"===this.inputType&&e.value.isVector2||"Vector3"===this.inputType&&e.value.isVector3||"Vector4"===this.inputType&&e.value.isVector4||"Color"===this.inputType&&e.value.isColor||"Matrix3"===this.inputType&&e.value.isMatrix3||"Matrix4"===this.inputType&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:ez()}serialize(e){super.serialize(e),null!==this.value?"ArrayBuffer"===this.inputType?e.value=z(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;null!==e.value&&(t="ArrayBuffer"===e.inputType?F(e.value):"Texture"===e.inputType?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const nk=eR(nH);er("scriptableValue",nk),H("ScriptableValueNode",nH);class nq extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(null!==t){let r=t(...s);return this.set(e,r),r}}}class nW{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){let t=this.parameters[e];return t?t.getValue():null}}const nj=new nq;class nX extends G{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new nq,this._output=nk(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(let t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(let t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){let s=this._outputs;return void 0===s[e]?s[e]=nk(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){let s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):void 0===s[e]?(s[e]=nk(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(let e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){let s=this.getObject()[e];if("function"==typeof s)return s(...t)}async callAsync(e,...t){let s=this.getObject()[e];if("function"==typeof s)return"AsyncFunction"===s.constructor.name?await s(...t):s(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){null!==e?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;let e=new nW(this),t=nj.get("THREE"),s=nj.get("TSL"),r=this.getMethod(this.codeNode),i=[e,this._local,nj,()=>this.refresh(),(e,t)=>this.setOutput(e,t),t,s];this._object=r(...i);let o=this._object.layout;if(o&&(!1===o.cache&&this._local.clear(),this._output.outputType=o.outputType||null,Array.isArray(o.elements)))for(let e of o.elements){let t=e.id||e.name;e.inputType&&(void 0===this.getParameter(t)&&this.setParameter(t,null),this.getParameter(t).inputType=e.inputType),e.outputType&&(void 0===this.getOutput(t)&&this.setOutput(t,null),this.getOutput(t).outputType=e.outputType)}return this._object}deserialize(e){for(let t in super.deserialize(e),this.parameters){let e=this.parameters[t];e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){let e=this.getDefaultOutput().value;return e&&e.isNode?e:ez()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;let e="layout, init, main, dispose",t="var "+e+"; var output = {};\n"+this.codeNode.code+"\nreturn { ...output, "+e+" };";return this._method=Function("parameters","local","global","refresh","setOutput","THREE","TSL",t),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){!0===e&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}er("scriptable",eR(nX)),H("ScriptableNode",nX);class n$ extends G{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}getViewZNode(e){let t;let s=e.context.getViewZ;return void 0!==s&&(t=s(this)),(t||iV.z).negate()}setup(){return this.factorNode}}var nY=n$;er("fog",eR(n$)),H("FogNode",n$);class nJ extends nY{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(e){let t=this.getViewZNode(e);return re(this.nearNode,this.farNode,t)}}er("rangeFog",eR(nJ)),H("FogRangeNode",nJ);class nK extends nY{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(e){let t=this.getViewZNode(e),s=this.densityNode;return s.mul(s,t,t).negate().exp().oneMinus()}}er("densityFog",eR(nK)),H("FogExp2Node",nK);var y=f("ilwiq");let nZ=null,nQ=null;class n0 extends G{constructor(e=ez(),t=ez()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){let t=e.getTypeLength(O(this.minNode.value)),s=e.getTypeLength(O(this.maxNode.value));return t>s?t:s}getNodeType(e){return!0===e.object.isInstancedMesh?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){let t=e.object,s=null;if(!0===t.isInstancedMesh){let r=this.minNode.value,i=this.maxNode.value,o=e.getTypeLength(O(r)),a=e.getTypeLength(O(i));nZ=nZ||new y.Vector4,nQ=nQ||new y.Vector4,nZ.setScalar(0),nQ.setScalar(0),1===o?nZ.setScalar(r):r.isColor?nZ.set(r.r,r.g,r.b):nZ.set(r.x,r.y,r.z||0,r.w||0),1===a?nQ.setScalar(i):i.isColor?nQ.set(i.r,i.g,i.b):nQ.set(i.x,i.y,i.z||0,i.w||0);let n=4*t.count,l=new Float32Array(n);for(let e=0;e<n;e++){let t=e%4,s=nZ.getComponent(t),r=nQ.getComponent(t);l[e]=(0,y.MathUtils).lerp(s,r,Math.random())}let u=this.getNodeType(e);s=rx(l,"vec4",t.count).element(ty).convert(u)}else s=ez(0);return s}}eR(n0),H("RangeNode",n0);class n1 extends G{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=S.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}updateDispatchCount(){let{count:e,workgroupSize:t}=this,s=t[0];for(let e=1;e<t.length;e++)s*=t[e];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){let{shaderStage:t}=e;if("compute"===t){let t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t)}}}er("compute",(e,t,s)=>eE(new n1(eE(e),t,s))),H("ComputeNode",n1);class n2 extends G{constructor(e=n2.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){let{scope:e,light:t}=this,s=null;return e===n2.TARGET_DIRECTION&&(s=rG.transformDirection(rO(t).sub(rO(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}n2.TARGET_DIRECTION="targetDirection";const n3=eR(n2,n2.TARGET_DIRECTION);H("LightNode",n2);const n4=eC(e=>{let{lightDistance:t,cutoffDistance:s,decayExponent:r}=e,i=t.pow(r).max(.01).reciprocal();return s.greaterThan(0).cond(i.mul(t.div(s).pow4().oneMinus().clamp().pow2()),i)});var y=f("ilwiq");class n5 extends i9{constructor(e=null){super(e),this.cutoffDistanceNode=t$(0),this.decayExponentNode=t$(0)}update(e){let{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){let{colorNode:t,cutoffDistanceNode:s,decayExponentNode:r,light:i}=this,o=e.context.lightingModel,a=rD(i).sub(iV),n=a.normalize(),l=n4({lightDistance:a.length(),cutoffDistance:s,decayExponent:r}),u=t.mul(l),d=e.context.reflectedLight;o.direct({lightDirection:n,lightColor:u,reflectedLight:d},e.stack,e)}}H("PointLightNode",n5),ot(y.PointLight,n5);var y=f("ilwiq");class n6 extends i9{constructor(e=null){super(e)}setup(e){super.setup(e);let t=e.context.lightingModel,s=this.colorNode,r=n3(this.light),i=e.context.reflectedLight;t.direct({lightDirection:r,lightColor:s,reflectedLight:i},e.stack,e)}}H("DirectionalLightNode",n6),ot(y.DirectionalLight,n6);var y=f("ilwiq");class n9 extends i9{constructor(e=null){super(e),this.coneCosNode=t$(0),this.penumbraCosNode=t$(0),this.cutoffDistanceNode=t$(0),this.decayExponentNode=t$(0)}update(e){super.update(e);let{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){let{coneCosNode:t,penumbraCosNode:s}=this;return re(t,s,e)}setup(e){super.setup(e);let t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:r,decayExponentNode:i,light:o}=this,a=rD(o).sub(iV),n=a.normalize(),l=n.dot(n3(o)),u=this.getSpotAttenuation(l),d=n4({lightDistance:a.length(),cutoffDistance:r,decayExponent:i}),h=s.mul(u).mul(d),c=e.context.reflectedLight;t.direct({lightDirection:n,lightColor:h,reflectedLight:c},e.stack,e)}}var n8=n9;H("SpotLightNode",n9),ot(y.SpotLight,n9);var y=f("ilwiq");class n7 extends y.SpotLight{constructor(e,t,s,r,i,o){super(e,t,s,r,i,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class le extends n8{getSpotAttenuation(e){let t=this.light.iesMap;return t&&!0===t.isTexture?rN(t,eB(e.acos().mul(1/Math.PI),0),0).r:super.getSpotAttenuation(e)}}H("IESSpotLightNode",le),ot(n7,le);var y=f("ilwiq");class lt extends i9{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}H("AmbientLightNode",lt),ot(y.AmbientLight,lt);var y=f("ilwiq");class ls extends i9{constructor(e=null){super(e),this.lightPositionNode=rO(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=t$(new y.Color)}update(e){let{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){let{colorNode:t,groundColorNode:s,lightDirectionNode:r}=this,i=s9(s,t,rY.dot(r).mul(.5).add(.5));e.context.irradiance.addAssign(i)}}H("HemisphereLightNode",ls),ot(y.HemisphereLight,ls);const lr=eC(e=>{let t=e.uv.mul(2),s=t.x.floor(),r=t.y.floor();return s.add(r).mod(2).sign()});class li extends q{constructor(e=tJ()){super("float"),this.uvNode=e}setup(){return lr({uv:this.uvNode})}}er("checker",eR(li)),H("CheckerNode",li);var y=(f("ilwiq"),f("ilwiq"),f("ilwiq"));const lo=new y.PointsMaterial;o9("InstancedPointsNodeMaterial",class extends o6{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(lo),this.setupShaders(),this.setValues(e)}setupShaders(){let e=this.alphaToCoverage,t=this.useColor;this.vertexNode=eC(()=>{tr(eB(),"vUv").assign(tJ());let e=ta("instancePosition"),t=tV("vec4","mvPos");t.assign(rk.mul(e$(e,1)));let s=oP.z.div(oP.w),r=rF.mul(t),i=tV("vec2","offset");return i.assign(iT.xy),i.assign(i.mul(iy)),i.assign(i.div(oP.z)),i.y.assign(i.y.mul(s)),i.assign(i.mul(r.w)),r.assign(r.add(e$(i,0,0))),r})(),this.fragmentNode=eC(()=>{let s=tr(eB(),"vUv"),r=tV("float","alpha");r.assign(1);let i=s.x,o=s.y,a=i.mul(i).add(o.mul(o));if(e){let e=tV("float","dlen");e.assign(a.fwidth()),r.assign(re(e.oneMinus(),e.add(1),a).oneMinus())}else a.greaterThan(1).discard();return e$(this.pointColorNode?this.pointColorNode:t?ta("instanceColor").mul(r3):r3,r)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}});var y=f("ilwiq");const la=new y.LineBasicMaterial;o9("LineBasicNodeMaterial",class extends o6{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(la),this.setValues(e)}});var y=f("ilwiq");const ln=new y.LineDashedMaterial;o9("LineDashedNodeMaterial",class extends o6{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(ln),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){let e=this.offsetNode,t=this.dashScaleNode?ez(this.dashScaleNode):ic,s=this.dashSizeNode?ez(this.dashSizeNode):ip,r=this.dashSizeNode?ez(this.dashGapNode):im;tU.assign(s),tB.assign(r);let i=tr(ta("lineDistance").mul(t));(e?i.add(e):i).mod(tU.add(tB)).greaterThan(tU).discard()}});var y=f("ilwiq");const ll=new y.LineDashedMaterial;o9("Line2NodeMaterial",class extends o6{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(ll),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setupShaders(),this.setValues(e)}setupShaders(){let e=this.alphaToCoverage,t=this.useColor,s=this.dashed,r=this.worldUnits,i=eC(({start:e,end:t})=>{let s=rF.element(2).element(2),r=rF.element(3).element(2).mul(-.5).div(s).sub(e.z).div(t.z.sub(e.z));return e$(s9(e.xyz,t.xyz,r),t.w)});this.vertexNode=eC(()=>{t_("vec2","vUv").assign(tJ());let e=ta("instanceStart"),t=ta("instanceEnd"),o=tV("vec4","start"),a=tV("vec4","end");o.assign(rk.mul(e$(e,1))),a.assign(rk.mul(e$(t,1))),r&&(t_("vec3","worldStart").assign(o.xyz),t_("vec3","worldEnd").assign(a.xyz));let n=oP.z.div(oP.w);eO(rF.element(2).element(3).equal(-1),()=>{eO(o.z.lessThan(0).and(a.z.greaterThan(0)),()=>{a.assign(i({start:o,end:a}))}).elseif(a.z.lessThan(0).and(o.z.greaterThanEqual(0)),()=>{o.assign(i({start:a,end:o}))})});let l=rF.mul(o),u=rF.mul(a),d=l.xyz.div(l.w),h=u.xyz.div(u.w),c=h.xy.sub(d.xy).temp();c.x.assign(c.x.mul(n)),c.assign(c.normalize());let p=tx(e$());if(r){let e=a.xyz.sub(o.xyz).normalize(),t=s9(o.xyz,a.xyz,.5).normalize(),r=e.cross(t).normalize(),i=e.cross(r),n=t_("vec4","worldPos");n.assign(iT.y.lessThan(.5).cond(o,a));let l=ig.mul(.5);n.addAssign(e$(iT.x.lessThan(0).cond(r.mul(l),r.mul(l).negate()),0)),s||(n.addAssign(e$(iT.y.lessThan(.5).cond(e.mul(l).negate(),e.mul(l)),0)),n.addAssign(e$(i.mul(l),0)),eO(iT.y.greaterThan(1).or(iT.y.lessThan(0)),()=>{n.subAssign(e$(i.mul(2).mul(l),0))})),p.assign(rF.mul(n));let u=tx(eq());u.assign(iT.y.lessThan(.5).cond(d,h)),p.z.assign(u.z.mul(p.w))}else{let e=tV("vec2","offset");e.assign(eB(c.y,c.x.negate())),c.x.assign(c.x.div(n)),e.x.assign(e.x.div(n)),e.assign(iT.x.lessThan(0).cond(e.negate(),e)),eO(iT.y.lessThan(0),()=>{e.assign(e.sub(c))}).elseif(iT.y.greaterThan(1),()=>{e.assign(e.add(c))}),e.assign(e.mul(ig)),e.assign(e.div(oP.w)),p.assign(iT.y.lessThan(.5).cond(l,u)),e.assign(e.mul(p.w)),p.assign(p.add(e$(e,0,0)))}return p})();let o=eC(({p1:e,p2:t,p3:s,p4:r})=>{let i=e.sub(s),o=r.sub(s),a=t.sub(e),n=i.dot(o),l=o.dot(a),u=i.dot(a),d=o.dot(o),h=a.dot(a).mul(d).sub(l.mul(l)),c=n.mul(l).sub(u.mul(d)).div(h).clamp(),p=n.add(l.mul(c)).div(d).clamp();return eB(c,p)});this.fragmentNode=eC(()=>{let i;let a=t_("vec2","vUv");if(s){let e=this.offsetNode?ez(this.offsetNodeNode):iN,t=this.dashScaleNode?ez(this.dashScaleNode):ic,s=this.dashSizeNode?ez(this.dashSizeNode):ip,r=this.dashSizeNode?ez(this.dashGapNode):im;tU.assign(s),tB.assign(r);let i=ta("instanceDistanceStart"),o=ta("instanceDistanceEnd"),n=tr(iT.y.lessThan(.5).cond(t.mul(i),ic.mul(o)).add(iN)),l=e?n.add(e):n;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),l.mod(tU.add(tB)).greaterThan(tU).discard()}let n=tV("float","alpha");if(n.assign(1),r){let t=t_("vec3","worldStart"),r=t_("vec3","worldEnd"),i=t_("vec4","worldPos").xyz.normalize().mul(1e5),a=r.sub(t),l=o({p1:t,p2:r,p3:eq(0,0,0),p4:i}),u=t.add(a.mul(l.x)),d=i.mul(l.y),h=u.sub(d).length().div(ig);if(!s){if(e){let e=h.fwidth();n.assign(re(e.negate().add(.5),e.add(.5),h).oneMinus())}else h.greaterThan(.5).discard()}}else if(e){let e=a.x,t=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),s=e.mul(e).add(t.mul(t)),r=tV("float","dlen");r.assign(s.fwidth()),eO(a.y.abs().greaterThan(1),()=>{n.assign(re(r.oneMinus(),r.add(1),s).oneMinus())})}else eO(a.y.abs().greaterThan(1),()=>{let e=a.x,t=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));e.mul(e).add(t.mul(t)).greaterThan(1).discard()});if(this.lineColorNode)i=this.lineColorNode;else if(t){let e=ta("instanceColorStart"),t=ta("instanceColorEnd");i=iT.y.lessThan(.5).cond(e,t).mul(r3)}else i=r3;return e$(i,n)})(),this.needsUpdate=!0}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.setupShaders())}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.setupShaders())}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}});var y=f("ilwiq");const lu=new y.MeshNormalMaterial;o9("MeshNormalNodeMaterial",class extends o6{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpaced=!1,this.setDefaultValues(lu),this.setValues(e)}setupDiffuseColor(){let e=this.opacityNode?ez(this.opacityNode):r6;tE.assign(e$(av(rK),e))}});var y=f("ilwiq");const ld=new y.MeshBasicMaterial;o9("MeshBasicNodeMaterial",class extends o6{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(ld),this.setValues(e)}});const lh=eC(({f0:e,f90:t,dotVH:s})=>{let r=s.mul(-5.55473).sub(6.98316).mul(s).exp2();return e.mul(r.oneMinus()).add(t.mul(r))}),lc=eC(e=>e.diffuseColor.mul(1/Math.PI)),lp=()=>ez(.25),lm=eC(({dotNH:e})=>tF.mul(.5/Math.PI).add(1).mul(e.pow(tF))),lg=eC(({lightDirection:e})=>{let t=e.add(i_).normalize(),s=rK.dot(t).clamp(),r=lh({f0:tz,f90:1,dotVH:i_.dot(t).clamp()}),i=lp(),o=lm({dotNH:s});return r.mul(i).mul(o)});var lf=class extends tv{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){let r=rK.dot(e).clamp().mul(t);s.directDiffuse.addAssign(r.mul(lc({diffuseColor:tE.rgb}))),!0===this.specular&&s.directSpecular.addAssign(r.mul(lg({lightDirection:e})).mul(r8))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(lc({diffuseColor:tE})))}},y=f("ilwiq");const lN=new y.MeshLambertMaterial;o9("MeshLambertNodeMaterial",class extends o6{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(lN),this.setValues(e)}setupLightingModel(){return new lf(!1)}});var y=f("ilwiq");const ly=new y.MeshPhongMaterial;o9("MeshPhongNodeMaterial",class extends o6{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(ly),this.setValues(e)}setupLightingModel(){return new lf}setupVariants(){let e=(this.shininessNode?ez(this.shininessNode):r4).max(1e-4);tF.assign(e);let t=this.specularNode||r9;tz.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}});const lv=eC(()=>{let e=rX.dFdx().abs().max(rX.dFdy().abs());return e.x.max(e.y).max(e.z)}),lT=eC(e=>{let{roughness:t}=e,s=lv(),r=t.max(.0525);return(r=r.add(s)).min(1)}),lx=eC(e=>{let{alpha:t,dotNL:s,dotNV:r}=e,i=t.pow2(),o=s.mul(i.add(i.oneMinus().mul(r.pow2())).sqrt()),a=r.mul(i.add(i.oneMinus().mul(s.pow2())).sqrt());return t3(.5,o.add(a).max(sc))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),lb=eC(({alpha:e,dotNH:t})=>{let s=e.pow2(),r=t.pow2().mul(s.oneMinus()).oneMinus();return s.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),lw=eC(e=>{let{lightDirection:t,f0:s,f90:r,roughness:i,iridescenceFresnel:o}=e,a=e.normalView||rK,n=i.pow2(),l=t.add(i_).normalize(),u=a.dot(t).clamp(),d=a.dot(i_).clamp(),h=a.dot(l).clamp(),c=lh({f0:s,f90:r,dotVH:i_.dot(l).clamp()});o&&(c=tI.mix(c,o));let p=lx({alpha:n,dotNL:u,dotNV:d}),m=lb({alpha:n,dotNH:h});return c.mul(p).mul(m)}),lV=eC(({roughness:e,dotNV:t})=>{let s=e$(-1,-.0275,-.572,.022),r=e$(1,.0425,1.04,-.04),i=e.mul(s).add(r),o=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return eB(-1.04,1.04).mul(o).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),l_=eC(e=>{let{dotNV:t,specularColor:s,specularF90:r,roughness:i}=e,o=lV({dotNV:t,roughness:i});return s.mul(o.x).add(r.mul(o.y))}),lE=eC(({f:e,f90:t,dotVH:s})=>{let r=s.oneMinus().saturate(),i=r.mul(r),o=r.mul(i,i).clamp(0,.9999);return e.sub(eq(t).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),lA=eC(({roughness:e,dotNH:t})=>{let s=e.pow2(),r=ez(1).div(s),i=t.pow2().oneMinus().max(.0078125);return ez(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),lM=eC(({dotNV:e,dotNL:t})=>ez(1).div(ez(4).mul(t.add(e).sub(t.mul(e))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),lR=eC(({lightDirection:e})=>{let t=e.add(i_).normalize(),s=rK.dot(e).clamp(),r=rK.dot(i_).clamp(),i=lA({roughness:tL,dotNH:rK.dot(t).clamp()}),o=lM({dotNV:r,dotNL:s});return tC.mul(i).mul(o)}),lS=e2(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),lC=e=>{let t=e.sqrt();return eq(1).add(t).div(eq(1).sub(t))},lL=(e,t)=>e.sub(t).div(e.add(t)).pow2(),lI=(e,t)=>{let s=e.mul(2*Math.PI*1e-9),r=eq(54856e-17,44201e-17,52481e-17),i=eq(1681e3,1795300,2208400),o=eq(43278e5,93046e5,66121e5),a=ez(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(s.mul(2239900).add(t.x).cos()).mul(s.pow2().mul(-45282e5).exp()),n=r.mul(o.mul(2*Math.PI).sqrt()).mul(i.mul(s).add(t).cos()).mul(s.pow2().negate().mul(o).exp());return n=eq(n.x.add(a),n.y,n.z).div(10685e-11),lS.mul(n)},lO=eC(({outsideIOR:e,eta2:t,cosTheta1:s,thinFilmThickness:r,baseF0:i})=>{let o=s9(e,t,re(0,.03,r)),a=e.div(o).pow2().mul(ez(1).sub(s.pow2())),n=ez(1).sub(a).sqrt(),l=lh({f0:lL(o,e),f90:1,dotVH:s}),u=l.oneMinus(),d=o.lessThan(e).cond(Math.PI,0),h=ez(Math.PI).sub(d),c=lC(i.clamp(0,.9999)),p=lh({f0:lL(c,o.vec3()),f90:1,dotVH:n}),m=eq(c.x.lessThan(o).cond(Math.PI,0),c.y.lessThan(o).cond(Math.PI,0),c.z.lessThan(o).cond(Math.PI,0)),g=o.mul(r,n,2),f=eq(h).add(m),N=l.mul(p).clamp(1e-5,.9999),y=N.sqrt(),v=u.pow2().mul(p).div(eq(1).sub(N)),T=l.add(v),x=v.sub(u);for(let e=1;e<=2;++e){x=x.mul(y);let t=lI(ez(e).mul(g),ez(e).mul(f)).mul(2);T=T.add(x.mul(t))}return T.max(eq(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),lD=eC(({normal:e,viewDir:t,roughness:s})=>{let r=e.dot(t).saturate(),i=s.pow2(),o=on(s.lessThan(.25),ez(-339.2).mul(i).add(ez(161.4).mul(s)).sub(25.9),ez(-8.48).mul(i).add(ez(14.3).mul(s)).sub(9.95)),a=on(s.lessThan(.25),ez(44).mul(i).sub(ez(23.7).mul(s)).add(3.26),ez(1.97).mul(i).sub(ez(3.27).mul(s)).add(.72));return on(s.lessThan(.25),0,ez(.1).mul(s).sub(.025)).add(o.mul(r).add(a).exp()).mul(1/Math.PI).saturate()}),lz=eq(.04),lF=eq(1);var lP=class extends tv{constructor(e=!1,t=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(){if(!0===this.clearcoat&&(this.clearcoatRadiance=eq().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=eq().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=eq().temp("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=eq().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=eq().temp("sheenSpecularIndirect")),!0===this.iridescence){let e=rK.dot(i_).clamp();this.iridescenceFresnel=lO({outsideIOR:ez(1),eta2:tO,cosTheta1:e,thinFilmThickness:tD,baseF0:tz}),this.iridescenceF0=lE({f:this.iridescenceFresnel,f90:1,dotVH:e})}}computeMultiscattering(e,t,s=ez(1)){let r=lV({roughness:tA,dotNV:rK.dot(i_).clamp()}),i=(this.iridescenceF0?tI.mix(tz,this.iridescenceF0):tz).mul(r.x).add(s.mul(r.y)),o=r.x.add(r.y).oneMinus(),a=tz.add(tz.oneMinus().mul(.047619)),n=i.mul(a).div(o.mul(a).oneMinus());e.addAssign(i),t.addAssign(n.mul(o))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){let r=rK.dot(e).clamp().mul(t);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(lR({lightDirection:e}))),!0===this.clearcoat){let s=rQ.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(s.mul(lw({lightDirection:e,f0:lz,f90:lF,roughness:tS,normalView:rQ})))}s.directDiffuse.addAssign(r.mul(lc({diffuseColor:tE.rgb}))),s.directSpecular.addAssign(r.mul(lw({lightDirection:e,f0:tz,f90:1,roughness:tA,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(lc({diffuseColor:tE})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(t.mul(tC,lD({normal:rK,viewDir:i_,roughness:tL}))),!0===this.clearcoat){let e=l_({dotNV:rQ.dot(i_).clamp(),specularColor:lz,specularF90:lF,roughness:tS});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(e))}let r=eq().temp("singleScattering"),i=eq().temp("multiScattering"),o=t.mul(1/Math.PI);this.computeMultiscattering(r,i);let a=r.add(i),n=tE.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(r)),s.indirectSpecular.addAssign(i.mul(o)),s.indirectDiffuse.addAssign(n.mul(o))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){let s=rK.dot(i_).clamp().add(e),r=tA.mul(-16).oneMinus().negate().exp2(),i=e.sub(s.pow(r).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(e),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(i)}finish(e){let{outgoingLight:t}=e;if(!0===this.clearcoat){let e=lh({dotVH:rQ.dot(i_).clamp(),f0:lz,f90:lF}),s=t.mul(tR.mul(e).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(tR));t.assign(s)}if(!0===this.sheen){let e=tC.r.max(tC.g).max(tC.b).mul(.157).oneMinus(),s=t.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(s)}}},y=f("ilwiq");const lU=new y.MeshStandardMaterial;class lB extends o6{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(lU),this.setValues(e)}setupLightingModel(){return new lP}setupVariants(){let e=this.metalnessNode?ez(this.metalnessNode):ie;tM.assign(e);let t=this.roughnessNode?ez(this.roughnessNode):r7;t=lT({roughness:t}),tA.assign(t);let s=s9(eq(.04),tE.rgb,e);tz.assign(s),tE.assign(e$(tE.rgb.mul(e.oneMinus()),tE.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}var lG=lB;o9("MeshStandardNodeMaterial",lB);var y=f("ilwiq");const lH=new y.MeshPhysicalMaterial;class lk extends lG{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(lH),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}setupLightingModel(){return new lP(this.useClearcoat,this.useSheen,this.useIridescence)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){let e=this.clearcoatNode?ez(this.clearcoatNode):is,t=this.clearcoatRoughnessNode?ez(this.clearcoatRoughnessNode):ir;tR.assign(e),tS.assign(t)}if(this.useSheen){let e=this.sheenNode?eq(this.sheenNode):ia,t=this.sheenRoughnessNode?ez(this.sheenRoughnessNode):il;tC.assign(e),tL.assign(t)}if(this.useIridescence){let e=this.iridescenceNode?ez(this.iridescenceNode):iu,t=this.iridescenceIORNode?ez(this.iridescenceIORNode):id,s=this.iridescenceThicknessNode?ez(this.iridescenceThicknessNode):ih;tI.assign(e),tO.assign(t),tD.assign(s)}}setupNormal(e){super.setupNormal(e);let t=this.clearcoatNormalNode?eq(this.clearcoatNormalNode):ii;rQ.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}var lq=lk;o9("MeshPhysicalNodeMaterial",lk);class lW extends lP{constructor(e,t,s,r){super(e,t,s),this.useSSS=r}direct({lightDirection:e,lightColor:t,reflectedLight:s},r,i){if(!0===this.useSSS){let{thicknessColorNode:r,thicknessDistortionNode:o,thicknessAmbientNode:a,thicknessAttenuationNode:n,thicknessPowerNode:l,thicknessScaleNode:u}=i.material,d=e.add(rK.mul(o)).normalize(),h=eq(ez(i_.dot(d.negate()).saturate().pow(l).mul(u)).add(a).mul(r));s.directDiffuse.addAssign(h.mul(n.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:s},r,i)}}o9("MeshSSSNodeMaterial",class extends lq{constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=ez(.1),this.thicknessAmbientNode=ez(0),this.thicknessAttenuationNode=ez(.1),this.thicknessPowerNode=ez(2),this.thicknessScaleNode=ez(10)}get useSSS(){return null!==this.thicknessColorNode}setupLightingModel(){return new lW(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}});var y=f("ilwiq");const lj=new y.PointsMaterial;o9("PointsNodeMaterial",class extends o6{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(lj),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}});var y=f("ilwiq");const lX=new y.SpriteMaterial;o9("SpriteNodeMaterial",class extends o6{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(lX),this.setValues(e)}setupPosition({object:e,context:t}){let{positionNode:s,rotationNode:r,scaleNode:i}=this,o=rk.mul(eq(s||0)),a=eB(rW[0].xyz.length(),rW[1].xyz.length());null!==i&&(a=a.mul(i));let n=ix.xy;e.center&&!0===e.center.isVector2&&(n=n.sub(t$(e.center).sub(.5))),n=n.mul(a);let l=ez(r||io),u=n.rotate(l);o=e$(o.xy.add(u),o.zw);let d=rF.mul(o);return t.vertex=ix,d}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}});const l$=y.MaterialLoader.createMaterialFromType;y.MaterialLoader.createMaterialFromType=function(e){let t=o8(e);return void 0!==t?t:l$.call(this,e)};var y=f("ilwiq");const lY=eC(([e,t,s])=>{let r=ez(s).toVar(),i=ez(t).toVar();return on(eU(e).toVar(),i,r)}),lJ=eC(([e,t])=>{let s=eU(t).toVar(),r=ez(e).toVar();return on(s,r.negate(),r)}),lK=eC(([e])=>eF(s_(ez(e).toVar()))),lZ=eC(([e,t])=>{let s=ez(e).toVar();return t.assign(lK(s)),s.sub(ez(t))}),lQ=eC(([e,t,s,r,i,o])=>{let a=ez(o).toVar(),n=ez(i).toVar(),l=ez(r).toVar(),u=ez(s).toVar(),d=ez(t).toVar(),h=ez(e).toVar(),c=ez(t1(1,n)).toVar();return t1(1,a).mul(h.mul(c).add(d.mul(n))).add(a.mul(u.mul(c).add(l.mul(n))))}),l0=eC(([e,t,s,r,i,o])=>{let a=ez(o).toVar(),n=ez(i).toVar(),l=eq(r).toVar(),u=eq(s).toVar(),d=eq(t).toVar(),h=eq(e).toVar(),c=ez(t1(1,n)).toVar();return t1(1,a).mul(h.mul(c).add(d.mul(n))).add(a.mul(u.mul(c).add(l.mul(n))))}),l1=ap([lQ,l0]),l2=eC(([e,t,s,r,i,o,a,n,l,u,d])=>{let h=ez(d).toVar(),c=ez(u).toVar(),p=ez(l).toVar(),m=ez(n).toVar(),g=ez(a).toVar(),f=ez(o).toVar(),N=ez(i).toVar(),y=ez(r).toVar(),v=ez(s).toVar(),T=ez(t).toVar(),x=ez(e).toVar(),b=ez(t1(1,p)).toVar(),w=ez(t1(1,c)).toVar();return ez(t1(1,h)).toVar().mul(w.mul(x.mul(b).add(T.mul(p))).add(c.mul(v.mul(b).add(y.mul(p))))).add(h.mul(w.mul(N.mul(b).add(f.mul(p))).add(c.mul(g.mul(b).add(m.mul(p))))))}),l3=eC(([e,t,s,r,i,o,a,n,l,u,d])=>{let h=ez(d).toVar(),c=ez(u).toVar(),p=ez(l).toVar(),m=eq(n).toVar(),g=eq(a).toVar(),f=eq(o).toVar(),N=eq(i).toVar(),y=eq(r).toVar(),v=eq(s).toVar(),T=eq(t).toVar(),x=eq(e).toVar(),b=ez(t1(1,p)).toVar(),w=ez(t1(1,c)).toVar();return ez(t1(1,h)).toVar().mul(w.mul(x.mul(b).add(T.mul(p))).add(c.mul(v.mul(b).add(y.mul(p))))).add(h.mul(w.mul(N.mul(b).add(f.mul(p))).add(c.mul(g.mul(b).add(m.mul(p))))))}),l4=ap([l2,l3]),l5=eC(([e,t,s])=>{let r=ez(s).toVar(),i=ez(t).toVar(),o=eP(e).toVar(),a=eP(o.bitAnd(eP(7))).toVar(),n=ez(lY(a.lessThan(eP(4)),i,r)).toVar(),l=ez(t2(2,lY(a.lessThan(eP(4)),r,i))).toVar();return lJ(n,eU(a.bitAnd(eP(1)))).add(lJ(l,eU(a.bitAnd(eP(2)))))}),l6=eC(([e,t,s,r])=>{let i=ez(r).toVar(),o=ez(s).toVar(),a=ez(t).toVar(),n=eP(e).toVar(),l=eP(n.bitAnd(eP(15))).toVar(),u=ez(lY(l.lessThan(eP(8)),a,o)).toVar(),d=ez(lY(l.lessThan(eP(4)),o,lY(l.equal(eP(12)).or(l.equal(eP(14))),a,i))).toVar();return lJ(u,eU(l.bitAnd(eP(1)))).add(lJ(d,eU(l.bitAnd(eP(2)))))}),l9=ap([l5,l6]),l8=eC(([e,t,s])=>{let r=ez(s).toVar(),i=ez(t).toVar(),o=ej(e).toVar();return eq(l9(o.x,i,r),l9(o.y,i,r),l9(o.z,i,r))}),l7=eC(([e,t,s,r])=>{let i=ez(r).toVar(),o=ez(s).toVar(),a=ez(t).toVar(),n=ej(e).toVar();return eq(l9(n.x,a,o,i),l9(n.y,a,o,i),l9(n.z,a,o,i))}),ue=ap([l8,l7]),ut=eC(([e])=>t2(.6616,ez(e).toVar())),us=eC(([e])=>t2(.982,ez(e).toVar())),ur=eC(([e])=>t2(.6616,eq(e).toVar())),ui=ap([ut,ur]),uo=eC(([e])=>t2(.982,eq(e).toVar())),ua=ap([us,uo]),un=eC(([e,t])=>{let s=eF(t).toVar(),r=eP(e).toVar();return r.shiftLeft(s).bitOr(r.shiftRight(eF(32).sub(s)))}),ul=eC(([e,t,s])=>{e.subAssign(s),e.bitXorAssign(un(s,eF(4))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(un(e,eF(6))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(un(t,eF(8))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(un(s,eF(16))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(un(e,eF(19))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(un(t,eF(4))),t.addAssign(e)}),uu=eC(([e,t,s])=>{let r=eP(s).toVar(),i=eP(t).toVar(),o=eP(e).toVar();return r.bitXorAssign(i),r.subAssign(un(i,eF(14))),o.bitXorAssign(r),o.subAssign(un(r,eF(11))),i.bitXorAssign(o),i.subAssign(un(o,eF(25))),r.bitXorAssign(i),r.subAssign(un(i,eF(16))),o.bitXorAssign(r),o.subAssign(un(r,eF(4))),i.bitXorAssign(o),i.subAssign(un(o,eF(14))),r.bitXorAssign(i),r.subAssign(un(i,eF(24))),r}),ud=eC(([e])=>ez(eP(e).toVar()).div(ez(eP(eF(4294967295))))),uh=eC(([e])=>{let t=ez(e).toVar();return t.mul(t.mul(t.mul(t.mul(t.mul(6).sub(15)).add(10))))}),uc=eC(([e])=>{let t=eF(e).toVar(),s=eP(eP(1)).toVar(),r=eP(eP(eF(3735928559)).add(s.shiftLeft(eP(2)).add(eP(13)))).toVar();return uu(r.add(eP(t)),r,r)}),up=eC(([e,t])=>{let s=eF(t).toVar(),r=eF(e).toVar(),i=eP(eP(2)).toVar(),o=eP().toVar(),a=eP().toVar(),n=eP().toVar();return o.assign(a.assign(n.assign(eP(eF(3735928559)).add(i.shiftLeft(eP(2)).add(eP(13)))))),o.addAssign(eP(r)),a.addAssign(eP(s)),uu(o,a,n)}),um=eC(([e,t,s])=>{let r=eF(s).toVar(),i=eF(t).toVar(),o=eF(e).toVar(),a=eP(eP(3)).toVar(),n=eP().toVar(),l=eP().toVar(),u=eP().toVar();return n.assign(l.assign(u.assign(eP(eF(3735928559)).add(a.shiftLeft(eP(2)).add(eP(13)))))),n.addAssign(eP(o)),l.addAssign(eP(i)),u.addAssign(eP(r)),uu(n,l,u)}),ug=eC(([e,t,s,r])=>{let i=eF(r).toVar(),o=eF(s).toVar(),a=eF(t).toVar(),n=eF(e).toVar(),l=eP(eP(4)).toVar(),u=eP().toVar(),d=eP().toVar(),h=eP().toVar();return u.assign(d.assign(h.assign(eP(eF(3735928559)).add(l.shiftLeft(eP(2)).add(eP(13)))))),u.addAssign(eP(n)),d.addAssign(eP(a)),h.addAssign(eP(o)),ul(u,d,h),u.addAssign(eP(i)),uu(u,d,h)}),uf=eC(([e,t,s,r,i])=>{let o=eF(i).toVar(),a=eF(r).toVar(),n=eF(s).toVar(),l=eF(t).toVar(),u=eF(e).toVar(),d=eP(eP(5)).toVar(),h=eP().toVar(),c=eP().toVar(),p=eP().toVar();return h.assign(c.assign(p.assign(eP(eF(3735928559)).add(d.shiftLeft(eP(2)).add(eP(13)))))),h.addAssign(eP(u)),c.addAssign(eP(l)),p.addAssign(eP(n)),ul(h,c,p),h.addAssign(eP(a)),c.addAssign(eP(o)),uu(h,c,p)}),uN=ap([uc,up,um,ug,uf]),uy=eC(([e,t])=>{let s=eF(t).toVar(),r=eP(uN(eF(e).toVar(),s)).toVar(),i=ej().toVar();return i.x.assign(r.bitAnd(eF(255))),i.y.assign(r.shiftRight(eF(8)).bitAnd(eF(255))),i.z.assign(r.shiftRight(eF(16)).bitAnd(eF(255))),i}),uv=eC(([e,t,s])=>{let r=eF(s).toVar(),i=eF(t).toVar(),o=eP(uN(eF(e).toVar(),i,r)).toVar(),a=ej().toVar();return a.x.assign(o.bitAnd(eF(255))),a.y.assign(o.shiftRight(eF(8)).bitAnd(eF(255))),a.z.assign(o.shiftRight(eF(16)).bitAnd(eF(255))),a}),uT=ap([uy,uv]),ux=eC(([e])=>{let t=eB(e).toVar(),s=eF().toVar(),r=eF().toVar(),i=ez(lZ(t.x,s)).toVar(),o=ez(lZ(t.y,r)).toVar(),a=ez(uh(i)).toVar(),n=ez(uh(o)).toVar();return ui(ez(l1(l9(uN(s,r),i,o),l9(uN(s.add(eF(1)),r),i.sub(1),o),l9(uN(s,r.add(eF(1))),i,o.sub(1)),l9(uN(s.add(eF(1)),r.add(eF(1))),i.sub(1),o.sub(1)),a,n)).toVar())}),ub=eC(([e])=>{let t=eq(e).toVar(),s=eF().toVar(),r=eF().toVar(),i=eF().toVar(),o=ez(lZ(t.x,s)).toVar(),a=ez(lZ(t.y,r)).toVar(),n=ez(lZ(t.z,i)).toVar(),l=ez(uh(o)).toVar(),u=ez(uh(a)).toVar(),d=ez(uh(n)).toVar();return ua(ez(l4(l9(uN(s,r,i),o,a,n),l9(uN(s.add(eF(1)),r,i),o.sub(1),a,n),l9(uN(s,r.add(eF(1)),i),o,a.sub(1),n),l9(uN(s.add(eF(1)),r.add(eF(1)),i),o.sub(1),a.sub(1),n),l9(uN(s,r,i.add(eF(1))),o,a,n.sub(1)),l9(uN(s.add(eF(1)),r,i.add(eF(1))),o.sub(1),a,n.sub(1)),l9(uN(s,r.add(eF(1)),i.add(eF(1))),o,a.sub(1),n.sub(1)),l9(uN(s.add(eF(1)),r.add(eF(1)),i.add(eF(1))),o.sub(1),a.sub(1),n.sub(1)),l,u,d)).toVar())}),uw=ap([ux,ub]),uV=eC(([e])=>{let t=eB(e).toVar(),s=eF().toVar(),r=eF().toVar(),i=ez(lZ(t.x,s)).toVar(),o=ez(lZ(t.y,r)).toVar(),a=ez(uh(i)).toVar(),n=ez(uh(o)).toVar();return ui(eq(l1(ue(uT(s,r),i,o),ue(uT(s.add(eF(1)),r),i.sub(1),o),ue(uT(s,r.add(eF(1))),i,o.sub(1)),ue(uT(s.add(eF(1)),r.add(eF(1))),i.sub(1),o.sub(1)),a,n)).toVar())}),u_=eC(([e])=>{let t=eq(e).toVar(),s=eF().toVar(),r=eF().toVar(),i=eF().toVar(),o=ez(lZ(t.x,s)).toVar(),a=ez(lZ(t.y,r)).toVar(),n=ez(lZ(t.z,i)).toVar(),l=ez(uh(o)).toVar(),u=ez(uh(a)).toVar(),d=ez(uh(n)).toVar();return ua(eq(l4(ue(uT(s,r,i),o,a,n),ue(uT(s.add(eF(1)),r,i),o.sub(1),a,n),ue(uT(s,r.add(eF(1)),i),o,a.sub(1),n),ue(uT(s.add(eF(1)),r.add(eF(1)),i),o.sub(1),a.sub(1),n),ue(uT(s,r,i.add(eF(1))),o,a,n.sub(1)),ue(uT(s.add(eF(1)),r,i.add(eF(1))),o.sub(1),a,n.sub(1)),ue(uT(s,r.add(eF(1)),i.add(eF(1))),o,a.sub(1),n.sub(1)),ue(uT(s.add(eF(1)),r.add(eF(1)),i.add(eF(1))),o.sub(1),a.sub(1),n.sub(1)),l,u,d)).toVar())}),uE=ap([uV,u_]),uA=eC(([e])=>ud(uN(eF(lK(ez(e).toVar())).toVar()))),uM=eC(([e])=>{let t=eB(e).toVar();return ud(uN(eF(lK(t.x)).toVar(),eF(lK(t.y)).toVar()))}),uR=eC(([e])=>{let t=eq(e).toVar();return ud(uN(eF(lK(t.x)).toVar(),eF(lK(t.y)).toVar(),eF(lK(t.z)).toVar()))}),uS=eC(([e])=>{let t=e$(e).toVar(),s=eF(lK(t.x)).toVar();return ud(uN(s,eF(lK(t.y)).toVar(),eF(lK(t.z)).toVar(),eF(lK(t.w)).toVar()))});ap([uA,uM,uR,uS]);const uC=eC(([e])=>{let t=eF(lK(ez(e).toVar())).toVar();return eq(ud(uN(t,eF(0))),ud(uN(t,eF(1))),ud(uN(t,eF(2))))}),uL=eC(([e])=>{let t=eB(e).toVar(),s=eF(lK(t.x)).toVar(),r=eF(lK(t.y)).toVar();return eq(ud(uN(s,r,eF(0))),ud(uN(s,r,eF(1))),ud(uN(s,r,eF(2))))}),uI=eC(([e])=>{let t=eq(e).toVar(),s=eF(lK(t.x)).toVar(),r=eF(lK(t.y)).toVar(),i=eF(lK(t.z)).toVar();return eq(ud(uN(s,r,i,eF(0))),ud(uN(s,r,i,eF(1))),ud(uN(s,r,i,eF(2))))}),uO=eC(([e])=>{let t=e$(e).toVar(),s=eF(lK(t.x)).toVar(),r=eF(lK(t.y)).toVar(),i=eF(lK(t.z)).toVar(),o=eF(lK(t.w)).toVar();return eq(ud(uN(s,r,i,o,eF(0))),ud(uN(s,r,i,o,eF(1))),ud(uN(s,r,i,o,eF(2))))}),uD=ap([uC,uL,uI,uO]),uz=eC(([e,t,s,r])=>{let i=ez(r).toVar(),o=ez(s).toVar(),a=eF(t).toVar(),n=eq(e).toVar(),l=ez(0).toVar(),u=ez(1).toVar();return ij({start:eF(0),end:a},({i:e})=>{l.addAssign(u.mul(uw(n))),u.mulAssign(i),n.mulAssign(o)}),l}),uF=eC(([e,t,s,r])=>{let i=ez(r).toVar(),o=ez(s).toVar(),a=eF(t).toVar(),n=eq(e).toVar(),l=eq(0).toVar(),u=ez(1).toVar();return ij({start:eF(0),end:a},({i:e})=>{l.addAssign(u.mul(uE(n))),u.mulAssign(i),n.mulAssign(o)}),l}),uP=eC(([e,t,s,r])=>{let i=ez(r).toVar(),o=ez(s).toVar(),a=eF(t).toVar(),n=eq(e).toVar();return eB(uz(n,a,o,i),uz(n.add(eq(eF(19),eF(193),eF(17))),a,o,i))}),uU=eC(([e,t,s,r])=>{let i=ez(r).toVar(),o=ez(s).toVar(),a=eF(t).toVar(),n=eq(e).toVar();return e$(eq(uF(n,a,o,i)).toVar(),ez(uz(n.add(eq(eF(19),eF(193),eF(17))),a,o,i)).toVar())}),uB=eC(([e,t,s,r,i,o,a])=>{let n=eF(a).toVar(),l=ez(o).toVar(),u=eF(i).toVar(),d=eF(r).toVar(),h=eF(s).toVar(),c=eF(t).toVar(),p=eB(e).toVar(),m=eq(uD(eB(c.add(d),h.add(u)))).toVar(),g=eB(m.x,m.y).toVar();g.subAssign(.5),g.mulAssign(l),g.addAssign(.5);let f=eB(eB(ez(c),ez(h)).add(g)).toVar(),N=eB(f.sub(p)).toVar();return eO(n.equal(eF(2)),()=>sD(N.x).add(sD(N.y))),eO(n.equal(eF(3)),()=>s$(sD(N.x),sD(N.y))),s0(N,N)}),uG=eC(([e,t,s,r,i,o,a,n,l])=>{let u=eF(l).toVar(),d=ez(n).toVar(),h=eF(a).toVar(),c=eF(o).toVar(),p=eF(i).toVar(),m=eF(r).toVar(),g=eF(s).toVar(),f=eF(t).toVar(),N=eq(e).toVar(),y=eq(uD(eq(f.add(p),g.add(c),m.add(h)))).toVar();y.subAssign(.5),y.mulAssign(d),y.addAssign(.5);let v=eq(eq(ez(f),ez(g),ez(m)).add(y)).toVar(),T=eq(v.sub(N)).toVar();return eO(u.equal(eF(2)),()=>sD(T.x).add(sD(T.y).add(sD(T.z)))),eO(u.equal(eF(3)),()=>s$(s$(sD(T.x),sD(T.y)),sD(T.z))),s0(T,T)}),uH=ap([uB,uG]),uk=eC(([e,t,s])=>{let r=eF(s).toVar(),i=ez(t).toVar(),o=eB(e).toVar(),a=eF().toVar(),n=eF().toVar(),l=eB(lZ(o.x,a),lZ(o.y,n)).toVar(),u=ez(1e6).toVar();return ij({start:-1,end:eF(1),name:"x",condition:"<="},({x:e})=>{ij({start:-1,end:eF(1),name:"y",condition:"<="},({y:t})=>{let s=ez(uH(l,e,t,a,n,i,r)).toVar();u.assign(sX(u,s))})}),eO(r.equal(eF(0)),()=>{u.assign(sw(u))}),u}),uq=eC(([e,t,s])=>{let r=eF(s).toVar(),i=ez(t).toVar(),o=eB(e).toVar(),a=eF().toVar(),n=eF().toVar(),l=eB(lZ(o.x,a),lZ(o.y,n)).toVar(),u=eB(1e6,1e6).toVar();return ij({start:-1,end:eF(1),name:"x",condition:"<="},({x:e})=>{ij({start:-1,end:eF(1),name:"y",condition:"<="},({y:t})=>{let s=ez(uH(l,e,t,a,n,i,r)).toVar();eO(s.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(s)}).elseif(s.lessThan(u.y),()=>{u.y.assign(s)})})}),eO(r.equal(eF(0)),()=>{u.assign(sw(u))}),u}),uW=eC(([e,t,s])=>{let r=eF(s).toVar(),i=ez(t).toVar(),o=eB(e).toVar(),a=eF().toVar(),n=eF().toVar(),l=eB(lZ(o.x,a),lZ(o.y,n)).toVar(),u=eq(1e6,1e6,1e6).toVar();return ij({start:-1,end:eF(1),name:"x",condition:"<="},({x:e})=>{ij({start:-1,end:eF(1),name:"y",condition:"<="},({y:t})=>{let s=ez(uH(l,e,t,a,n,i,r)).toVar();eO(s.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(s)}).elseif(s.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(s)}).elseif(s.lessThan(u.z),()=>{u.z.assign(s)})})}),eO(r.equal(eF(0)),()=>{u.assign(sw(u))}),u}),uj=eC(([e,t,s])=>{let r=eF(s).toVar(),i=ez(t).toVar(),o=eq(e).toVar(),a=eF().toVar(),n=eF().toVar(),l=eF().toVar(),u=eq(lZ(o.x,a),lZ(o.y,n),lZ(o.z,l)).toVar(),d=ez(1e6).toVar();return ij({start:-1,end:eF(1),name:"x",condition:"<="},({x:e})=>{ij({start:-1,end:eF(1),name:"y",condition:"<="},({y:t})=>{ij({start:-1,end:eF(1),name:"z",condition:"<="},({z:s})=>{let o=ez(uH(u,e,t,s,a,n,l,i,r)).toVar();d.assign(sX(d,o))})})}),eO(r.equal(eF(0)),()=>{d.assign(sw(d))}),d});ap([uk,uj]);const uX=eC(([e,t,s])=>{let r=eF(s).toVar(),i=ez(t).toVar(),o=eq(e).toVar(),a=eF().toVar(),n=eF().toVar(),l=eF().toVar(),u=eq(lZ(o.x,a),lZ(o.y,n),lZ(o.z,l)).toVar(),d=eB(1e6,1e6).toVar();return ij({start:-1,end:eF(1),name:"x",condition:"<="},({x:e})=>{ij({start:-1,end:eF(1),name:"y",condition:"<="},({y:t})=>{ij({start:-1,end:eF(1),name:"z",condition:"<="},({z:s})=>{let o=ez(uH(u,e,t,s,a,n,l,i,r)).toVar();eO(o.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(o)}).elseif(o.lessThan(d.y),()=>{d.y.assign(o)})})})}),eO(r.equal(eF(0)),()=>{d.assign(sw(d))}),d});ap([uq,uX]);const u$=eC(([e,t,s])=>{let r=eF(s).toVar(),i=ez(t).toVar(),o=eq(e).toVar(),a=eF().toVar(),n=eF().toVar(),l=eF().toVar(),u=eq(lZ(o.x,a),lZ(o.y,n),lZ(o.z,l)).toVar(),d=eq(1e6,1e6,1e6).toVar();return ij({start:-1,end:eF(1),name:"x",condition:"<="},({x:e})=>{ij({start:-1,end:eF(1),name:"y",condition:"<="},({y:t})=>{ij({start:-1,end:eF(1),name:"z",condition:"<="},({z:s})=>{let o=ez(uH(u,e,t,s,a,n,l,i,r)).toVar();eO(o.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(o)}).elseif(o.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(o)}).elseif(o.lessThan(d.z),()=>{d.z.assign(o)})})})}),eO(r.equal(eF(0)),()=>{d.assign(sw(d))}),d});ap([uW,u$]),lY.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),lJ.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),lK.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),lQ.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),l0.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),l2.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),l3.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),l5.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),l6.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),l8.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),l7.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),ut.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),us.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),ur.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),uo.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),un.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),uu.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),ud.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),uh.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),uc.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),up.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),um.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),ug.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),uf.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),uy.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),uv.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),ux.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),ub.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),uV.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),u_.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),uA.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),uM.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),uR.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),uS.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),uC.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),uL.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),uI.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),uO.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),uz.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),uF.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),uP.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),uU.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),uB.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uG.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uk.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uq.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uW.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uj.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uX.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),u$.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const uY=eC(([e])=>{let t=eq(e).toVar(),s=ez(t.x).toVar(),r=ez(t.y).toVar(),i=ez(t.z).toVar();eO(r.lessThan(1e-4),()=>eq(i,i,i)).else(()=>{s.assign(t2(6,s.sub(s_(s))));let e=eF(sq(s)).toVar(),t=ez(s.sub(ez(e))).toVar(),o=ez(i.mul(t1(1,r))).toVar(),a=ez(i.mul(t1(1,r.mul(t)))).toVar(),n=ez(i.mul(t1(1,r.mul(t1(1,t))))).toVar();return eO(e.equal(eF(0)),()=>eq(i,n,o)).elseif(e.equal(eF(1)),()=>eq(a,i,o)).elseif(e.equal(eF(2)),()=>eq(o,i,n)).elseif(e.equal(eF(3)),()=>eq(o,a,i)).elseif(e.equal(eF(4)),()=>eq(n,o,i)),eq(i,o,a)})}),uJ=eC(([e])=>{let t=eq(e).toVar(),s=ez(t.x).toVar(),r=ez(t.y).toVar(),i=ez(t.z).toVar(),o=ez(sX(s,sX(r,i))).toVar(),a=ez(s$(s,s$(r,i))).toVar(),n=ez(a.sub(o)).toVar(),l=ez().toVar(),u=ez().toVar(),d=ez().toVar();return d.assign(a),eO(a.greaterThan(0),()=>{u.assign(n.div(a))}).else(()=>{u.assign(0)}),eO(u.lessThanEqual(0),()=>{l.assign(0)}).else(()=>{eO(s.greaterThanEqual(a),()=>{l.assign(r.sub(i).div(n))}).elseif(r.greaterThanEqual(a),()=>{l.assign(t0(2,i.sub(s).div(n)))}).else(()=>{l.assign(t0(4,s.sub(r).div(n)))}),l.mulAssign(1/6),eO(l.lessThan(0),()=>{l.addAssign(1)})}),eq(l,u,d)});uY.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),uJ.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),eC(([e])=>{let t=eq(e).toVar(),s=eX(t8(t,eq(.04045))).toVar();return s9(eq(t.div(12.92)).toVar(),eq(s2(s$(t.add(eq(.055)),eq(0)).div(1.055),eq(2.4))).toVar(),s)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});let uK=0;const uZ={bounces:5,samplesPerFrame:1,renderScale:1/window.devicePixelRatio,tiles:1,autoPause:!0,pause:!1,continuous:!1,stableNoise:!1,...(0,A.getScaledSettings)()};function uQ(e){d.paused=e,uZ.pause=e,e&&u1()}function u0(){i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio),a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),r.updateCamera()}function u1(){r.bounces=uZ.bounces,r.setScene(n,a)}!async function(){(h=new M.LoaderElement).setDescription("Rendering deformable geometry with path tracing."),h.attach(document.body),(i=new y.WebGLRenderer({antialias:!0})).toneMapping=y.ACESFilmicToneMapping,document.body.appendChild(i.domElement),(r=new b.WebGLPathTracer(i)).multipleImportanceSampling=!1,r.tiles.set(uZ.tiles,uZ.tiles),r.filterGlossyFactor=.25,r.minSamples=1,r.renderDelay=0,r.fadeDuration=0,n=new y.Scene;let e=new y.Vector3(-5.5,8.5,7.5);(a=new y.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.025,500)).position.set(e.x,e.y,e.z),o=new T.OrbitControls(a,i.domElement),a.lookAt(o.target),o.addEventListener("change",()=>r.updateCamera()),o.update(),l=new y.Clock;let t="#morphtarget"===window.location.hash?"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/gltf/RobotExpressive/RobotExpressive.glb":"https://raw.githubusercontent.com/disini/3DModels/main/glb/animated/project_polly.glb",[s,c]=await Promise.all([new(0,w.RGBELoader)().loadAsync("https://raw.githubusercontent.com/disini/3d-demo-data/master/hdri/peppermint_powerplant_2k.hdr"),new(0,v.GLTFLoader)().setMeshoptDecoder(V.MeshoptDecoder).loadAsync(t)]),p=new x.BlurredEnvMapGenerator(i),m=p.generate(s,.01);n.background=m,n.environment=m,p.dispose();let g=c.animations;(d=(u=new y.AnimationMixer(c.scene)).clipAction(g[0])).play(),d.paused=uZ.pause,n.add(c.scene),c.scene.scale.set(10,10,10);let f=c.scene.position;console.log("pos == "+f.x+", "+f.y+", "+f.z);let N=(0,E.generateRadialFloorTexture)(2048),A=new y.Mesh(new y.PlaneGeometry,new y.MeshStandardMaterial({map:N,transparent:!0,color:14540253,roughness:.15,metalness:1}));A.scale.setScalar(50),A.rotation.x=-Math.PI/2,A.position.y=.075,n.add(A),r.setScene(n,a),h.setPercentage(1),h.setCredits(" "),r.filterGlossyFactor=uZ.filterGlossyFactor,r.bounces=uZ.bounces,r.renderScale=uZ.renderScale,r.updateCamera(),r.reset(),u0(),window.addEventListener("resize",u0);let R=new _.GUI;R.add(uZ,"tiles",1,4,1).onChange(e=>{r.tiles.set(e,e)}),R.add(uZ,"bounces",1,10,1).onChange(u1),R.add(uZ,"renderScale",.1,1).onChange(e=>{r.renderScale=e,r.reset()}),R.add(uZ,"autoPause").listen(),R.add(uZ,"pause").onChange(e=>{uZ.autoPause=!1,uQ(e)}).listen(),R.add(uZ,"continuous").onChange(()=>{uZ.autoPause=!1}),R.add(uZ,"stableNoise").onChange(e=>{r.stableNoise=e}),function e(){requestAnimationFrame(e);let t=Math.min(l.getDelta(),.03);u.update(t),uZ.autoPause?(uK+=t,(!uZ.pause&&uK>=8||uZ.pause&&uK>=30)&&(uQ(!uZ.pause),uK=0)):uK=0,r.dynamicLowRes=uZ.continuous,uZ.pause||uZ.continuous?(!uZ.pause&&uZ.continuous&&u1(),r.renderSample(),h.setSamples(r.samples,r.isCompiling)):(i.render(n,a),h.setSamples(0,r.isCompiling))}()}();
//# sourceMappingURL=skinnedMesh.49d8c0b2.js.map
